# MuJoCo Simulation Configuration for Module 06: Motion Planning
# This configuration defines the simulation environment for planning labs

id: mod06-motion-planning
platform: mujoco
version: "3.0+"

# Primary robot model
robot_model:
  path: textbook/assets/robot-models/mujoco/2dof-arm-obstacles.xml
  description: Two-link arm with obstacles for path planning

# Alternate models
alternate_models:
  - id: mobile-robot
    path: textbook/assets/robot-models/mujoco/mobile-robot.xml
    description: Differential drive mobile robot
    labs: [lab-06-02, project]
  - id: 6dof-arm
    path: textbook/assets/robot-models/mujoco/6dof-arm.xml
    description: 6-DOF industrial arm for advanced planning
    labs: [project]

# Environment configuration
environment:
  scene: planning_workspace
  ground_plane: true
  gravity: [0, 0, -9.81]

  # Obstacles for path planning
  obstacles:
    # Rectangular obstacles
    - type: box
      name: wall_1
      position: [0.4, 0.0, 0.15]
      size: [0.05, 0.3, 0.15]
      color: [0.5, 0.5, 0.5, 1.0]
    - type: box
      name: wall_2
      position: [0.2, 0.4, 0.15]
      size: [0.25, 0.05, 0.15]
      color: [0.5, 0.5, 0.5, 1.0]
    - type: box
      name: wall_3
      position: [-0.3, 0.3, 0.15]
      size: [0.05, 0.2, 0.15]
      color: [0.5, 0.5, 0.5, 1.0]

    # Cylindrical obstacles
    - type: cylinder
      name: pillar_1
      position: [0.3, 0.3, 0.2]
      size: [0.08, 0.2]
      color: [0.6, 0.3, 0.3, 1.0]
    - type: cylinder
      name: pillar_2
      position: [-0.2, 0.5, 0.2]
      size: [0.1, 0.2]
      color: [0.6, 0.3, 0.3, 1.0]

# Physics settings
physics:
  timestep: 0.002  # 500 Hz
  gravity: [0, 0, -9.81]
  solver_iterations: 50
  integrator: implicitfast

# Robot parameters for 2-DOF arm
robot_params:
  link_1:
    length: 0.5
    mass: 2.0
    inertia: 0.042
  link_2:
    length: 0.4
    mass: 1.5
    inertia: 0.02
  joint_limits:
    q1: [-3.14, 3.14]
    q2: [-3.14, 3.14]
  velocity_limits:
    qd1: [-5.0, 5.0]
    qd2: [-5.0, 5.0]
  torque_limits:
    tau1: [-50.0, 50.0]
    tau2: [-30.0, 30.0]

# Collision checking configuration
collision:
  # Number of points to check along each link
  resolution: 20
  # Safety margin around obstacles
  safety_margin: 0.02  # meters
  # Self-collision checking
  self_collision: false

# Visualization settings
visualization:
  render_mode: window
  camera:
    position: [0, -1.5, 1.0]
    lookat: [0, 0, 0.2]
  show_obstacles: true
  show_trajectory: true
  trajectory_color: [0, 0, 1, 0.5]

# Lab-specific configurations
lab_configs:
  lab-06-01:
    description: "RRT Path Planning"
    planning_algorithm: rrt
    parameters:
      step_size: 0.15  # radians
      goal_bias: 0.1
      max_iterations: 5000
      goal_threshold: 0.1
    test_cases:
      - start: [0, 0]
        goal: [1.57, -0.79]  # ~90°, ~-45°
      - start: [-0.5, 0.5]
        goal: [1.0, -1.0]
      - start: [0, 0]
        goal: [2.5, -1.5]  # Challenging - behind obstacles

  lab-06-02:
    description: "A* Path Planning"
    planning_algorithm: astar
    grid_resolution: 0.05  # meters for workspace, 0.1 rad for C-space
    heuristics:
      - euclidean
      - manhattan
      - diagonal
    connectivity: 8  # 8-connected grid

  lab-06-03:
    description: "Trajectory Optimization"
    planning_algorithm: direct_collocation
    parameters:
      n_waypoints: 20
      time_min: 0.5
      time_max: 5.0
    cost_weights:
      time: 1.0
      energy: 0.1
      smoothness: 0.01
    constraints:
      dynamics: true
      velocity_limits: true
      torque_limits: true

# Planning performance metrics
metrics:
  path_planning:
    - planning_time_ms
    - path_length_rad
    - nodes_expanded
    - collision_checks
    - success_rate
  trajectory_optimization:
    - optimization_time_ms
    - trajectory_duration
    - total_energy
    - max_velocity
    - max_torque
    - constraint_violation

# Multi-robot configuration (for project)
multi_robot:
  num_robots: 3
  robot_type: mobile-robot
  coordination_method: priority  # priority | velocity_obstacles | cbs
  communication_range: 5.0  # meters

  robots:
    - id: robot_1
      start: [1.0, 1.0, 0]
      goal: [8.0, 8.0, 0]
      priority: 1
    - id: robot_2
      start: [8.0, 1.0, 0]
      goal: [1.0, 8.0, 0]
      priority: 2
    - id: robot_3
      start: [5.0, 5.0, 0]
      goal: [5.0, 1.0, 0]
      priority: 3

# Testing configuration
testing:
  scenarios:
    - name: simple
      obstacles: basic
      difficulty: easy
    - name: narrow_passage
      obstacles: narrow
      difficulty: medium
    - name: cluttered
      obstacles: dense
      difficulty: hard

  expected_performance:
    rrt_success_rate: 0.95
    astar_optimality: true
    trajectory_convergence: 0.9

# Docker/container setup
docker:
  image: mujoco-planning:mod06
  build_context: docker/ros2-humble/
  volumes:
    - ./textbook:/textbook:ro
    - ./data:/data:rw

# References
references:
  - textbook/modules/06-motion-planning/theory.md
  - textbook/modules/06-motion-planning/labs/
  - textbook/case-studies/manufacturing/2024-amazon-digit.md
