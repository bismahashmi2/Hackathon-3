"use strict";(globalThis.webpackChunkmy_book=globalThis.webpackChunkmy_book||[]).push([[3356],{6913(s,e,n){n.r(e),n.d(e,{assets:()=>m,contentTitle:()=>r,default:()=>d,frontMatter:()=>l,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"textbook/modules/dynamics-control/labs/lab-05-01","title":"Implementing PID Control for a 2-DOF Arm","description":"Objectives","source":"@site/docs/textbook/modules/05-dynamics-control/labs/lab-05-01.md","sourceDirName":"textbook/modules/05-dynamics-control/labs","slug":"/textbook/modules/dynamics-control/labs/lab-05-01","permalink":"/Hackathon-3/docs/textbook/modules/dynamics-control/labs/lab-05-01","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/textbook/modules/05-dynamics-control/labs/lab-05-01.md","tags":[],"version":"current","frontMatter":{"id":"lab-05-01","module_id":"05","title":"Implementing PID Control for a 2-DOF Arm","difficulty":"guided","tier":"simulation","duration_minutes":60},"sidebar":"tutorialSidebar","previous":{"title":"Ethics in Dynamics and Control","permalink":"/Hackathon-3/docs/textbook/modules/dynamics-control/ethics"},"next":{"title":"Computed Torque Control","permalink":"/Hackathon-3/docs/textbook/modules/dynamics-control/labs/lab-05-02"}}');var i=n(4848),a=n(8453);const l={id:"lab-05-01",module_id:"05",title:"Implementing PID Control for a 2-DOF Arm",difficulty:"guided",tier:"simulation",duration_minutes:60},r="Lab 05-01: Implementing PID Control for a 2-DOF Arm",m={},c=[{value:"Objectives",id:"objectives",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Materials",id:"materials",level:2},{value:"Background",id:"background",level:2},{value:"PID Control",id:"pid-control",level:3},{value:"Discrete Implementation",id:"discrete-implementation",level:3},{value:"Instructions",id:"instructions",level:2},{value:"Step 1: Set Up the Simulation Environment",id:"step-1-set-up-the-simulation-environment",level:3},{value:"Step 2: Implement the PID Controller Class",id:"step-2-implement-the-pid-controller-class",level:3},{value:"Step 3: Control a Single Joint",id:"step-3-control-a-single-joint",level:3},{value:"Step 4: Analyze Step Response",id:"step-4-analyze-step-response",level:3},{value:"Step 5: Visualize the Response",id:"step-5-visualize-the-response",level:3},{value:"Step 6: Tune the Controller",id:"step-6-tune-the-controller",level:3},{value:"Expected Outcomes",id:"expected-outcomes",level:2},{value:"Rubric",id:"rubric",level:2},{value:"Common Errors",id:"common-errors",level:2},{value:"Extensions",id:"extensions",level:2},{value:"Related Content",id:"related-content",level:2}];function o(s){const e={annotation:"annotation",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",math:"math",mfrac:"mfrac",mi:"mi",mn:"mn",mo:"mo",mrow:"mrow",msub:"msub",msubsup:"msubsup",ol:"ol",p:"p",pre:"pre",semantics:"semantics",span:"span",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...s.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"lab-05-01-implementing-pid-control-for-a-2-dof-arm",children:"Lab 05-01: Implementing PID Control for a 2-DOF Arm"})}),"\n",(0,i.jsx)(e.h2,{id:"objectives",children:"Objectives"}),"\n",(0,i.jsx)(e.p,{children:"By the end of this lab, you will be able to:"}),"\n",(0,i.jsxs)(e.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(e.li,{className:"task-list-item",children:[(0,i.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Implement a PID (Proportional-Integral-Derivative) controller from scratch"]}),"\n",(0,i.jsxs)(e.li,{className:"task-list-item",children:[(0,i.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Tune PID gains using systematic methods"]}),"\n",(0,i.jsxs)(e.li,{className:"task-list-item",children:[(0,i.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Analyze step response characteristics (rise time, overshoot, settling time)"]}),"\n",(0,i.jsxs)(e.li,{className:"task-list-item",children:[(0,i.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Understand the effect of each gain component on system behavior"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Completed Module 03 (Kinematics) - understanding of joint space"}),"\n",(0,i.jsx)(e.li,{children:"Basic calculus (derivatives, integrals)"}),"\n",(0,i.jsx)(e.li,{children:"Python programming with NumPy"}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"materials",children:"Materials"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"Type"}),(0,i.jsx)(e.th,{children:"Name"}),(0,i.jsx)(e.th,{children:"Tier"}),(0,i.jsx)(e.th,{children:"Notes"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"software"}),(0,i.jsx)(e.td,{children:"MuJoCo 3.0+"}),(0,i.jsx)(e.td,{children:"required"}),(0,i.jsx)(e.td,{children:"Physics simulation"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"software"}),(0,i.jsx)(e.td,{children:"Python 3.10+"}),(0,i.jsx)(e.td,{children:"required"}),(0,i.jsx)(e.td,{children:"Programming environment"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"software"}),(0,i.jsx)(e.td,{children:"NumPy, Matplotlib"}),(0,i.jsx)(e.td,{children:"required"}),(0,i.jsx)(e.td,{children:"Computation and visualization"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"simulation"}),(0,i.jsx)(e.td,{children:"2dof-arm.xml"}),(0,i.jsx)(e.td,{children:"required"}),(0,i.jsx)(e.td,{children:"Two-link planar arm model"})]})]})]}),"\n",(0,i.jsx)(e.h2,{id:"background",children:"Background"}),"\n",(0,i.jsx)(e.h3,{id:"pid-control",children:"PID Control"}),"\n",(0,i.jsx)(e.p,{children:"The PID controller computes a control signal based on the error between desired and actual states:"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mi,{children:"u"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"("}),(0,i.jsx)(e.mi,{children:"t"}),(0,i.jsx)(e.mo,{stretchy:"false",children:")"}),(0,i.jsx)(e.mo,{children:"="}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"K"}),(0,i.jsx)(e.mi,{children:"p"})]}),(0,i.jsx)(e.mi,{children:"e"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"("}),(0,i.jsx)(e.mi,{children:"t"}),(0,i.jsx)(e.mo,{stretchy:"false",children:")"}),(0,i.jsx)(e.mo,{children:"+"}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"K"}),(0,i.jsx)(e.mi,{children:"i"})]}),(0,i.jsxs)(e.msubsup,{children:[(0,i.jsx)(e.mo,{children:"\u222b"}),(0,i.jsx)(e.mn,{children:"0"}),(0,i.jsx)(e.mi,{children:"t"})]}),(0,i.jsx)(e.mi,{children:"e"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"("}),(0,i.jsx)(e.mi,{children:"\u03c4"}),(0,i.jsx)(e.mo,{stretchy:"false",children:")"}),(0,i.jsx)(e.mi,{children:"d"}),(0,i.jsx)(e.mi,{children:"\u03c4"}),(0,i.jsx)(e.mo,{children:"+"}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"K"}),(0,i.jsx)(e.mi,{children:"d"})]}),(0,i.jsxs)(e.mfrac,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mi,{children:"d"}),(0,i.jsx)(e.mi,{children:"e"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"("}),(0,i.jsx)(e.mi,{children:"t"}),(0,i.jsx)(e.mo,{stretchy:"false",children:")"})]}),(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mi,{children:"d"}),(0,i.jsx)(e.mi,{children:"t"})]})]})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"u(t) = K_p e(t) + K_i \\int_0^t e(\\tau) d\\tau + K_d \\frac{de(t)}{dt}"})]})})}),(0,i.jsxs)(e.span,{className:"katex-html","aria-hidden":"true",children:[(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",children:"u"}),(0,i.jsx)(e.span,{className:"mopen",children:"("}),(0,i.jsx)(e.span,{className:"mord mathnormal",children:"t"}),(0,i.jsx)(e.span,{className:"mclose",children:")"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,i.jsx)(e.span,{className:"mrel",children:"="}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1.0361em",verticalAlign:"-0.2861em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"K"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.1514em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"p"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.2861em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mord mathnormal",children:"e"}),(0,i.jsx)(e.span,{className:"mopen",children:"("}),(0,i.jsx)(e.span,{className:"mord mathnormal",children:"t"}),(0,i.jsx)(e.span,{className:"mclose",children:")"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,i.jsx)(e.span,{className:"mbin",children:"+"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1.3443em",verticalAlign:"-0.3558em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"K"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3117em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"i"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,i.jsxs)(e.span,{className:"mop",children:[(0,i.jsx)(e.span,{className:"mop op-symbol small-op",style:{marginRight:"0.19445em",position:"relative",top:"-0.0006em"},children:"\u222b"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsxs)(e.span,{className:"vlist",style:{height:"0.9885em"},children:[(0,i.jsxs)(e.span,{style:{top:"-2.3442em",marginLeft:"-0.1945em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mtight",children:"0"})})]}),(0,i.jsxs)(e.span,{style:{top:"-3.2579em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"})})]})]}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3558em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",children:"e"}),(0,i.jsx)(e.span,{className:"mopen",children:"("}),(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.1132em"},children:"\u03c4"}),(0,i.jsx)(e.span,{className:"mclose",children:")"}),(0,i.jsx)(e.span,{className:"mord mathnormal",children:"d"}),(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.1132em"},children:"\u03c4"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,i.jsx)(e.span,{className:"mbin",children:"+"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1.355em",verticalAlign:"-0.345em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"K"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3361em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"d"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mopen nulldelimiter"}),(0,i.jsx)(e.span,{className:"mfrac",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsxs)(e.span,{className:"vlist",style:{height:"1.01em"},children:[(0,i.jsxs)(e.span,{style:{top:"-2.655em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsxs)(e.span,{className:"mord mtight",children:[(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"d"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"})]})})]}),(0,i.jsxs)(e.span,{style:{top:"-3.23em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"frac-line",style:{borderBottomWidth:"0.04em"}})]}),(0,i.jsxs)(e.span,{style:{top:"-3.485em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsxs)(e.span,{className:"mord mtight",children:[(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"d"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"e"}),(0,i.jsx)(e.span,{className:"mopen mtight",children:"("}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"}),(0,i.jsx)(e.span,{className:"mclose mtight",children:")"})]})})]})]}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.345em"},children:(0,i.jsx)(e.span,{})})})]})}),(0,i.jsx)(e.span,{className:"mclose nulldelimiter"})]})]})]})]})}),"\n",(0,i.jsx)(e.p,{children:"Where:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsx)(e.mrow,{children:(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"K"}),(0,i.jsx)(e.mi,{children:"p"})]})}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"K_p"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"0.9694em",verticalAlign:"-0.2861em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"K"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.1514em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"p"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.2861em"},children:(0,i.jsx)(e.span,{})})})]})})]})]})})]}),": Proportional gain - responds to current error"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsx)(e.mrow,{children:(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"K"}),(0,i.jsx)(e.mi,{children:"i"})]})}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"K_i"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"0.8333em",verticalAlign:"-0.15em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"K"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3117em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"i"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]})]})})]}),": Integral gain - eliminates steady-state error"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsx)(e.mrow,{children:(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"K"}),(0,i.jsx)(e.mi,{children:"d"})]})}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"K_d"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"0.8333em",verticalAlign:"-0.15em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"K"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3361em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"d"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]})]})})]}),": Derivative gain - dampens oscillations"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"discrete-implementation",children:"Discrete Implementation"}),"\n",(0,i.jsxs)(e.p,{children:["For digital control at timestep ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mi,{mathvariant:"normal",children:"\u0394"}),(0,i.jsx)(e.mi,{children:"t"})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\Delta t"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"0.6833em"}}),(0,i.jsx)(e.span,{className:"mord",children:"\u0394"}),(0,i.jsx)(e.span,{className:"mord mathnormal",children:"t"})]})})]}),":"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mi,{children:"u"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"["}),(0,i.jsx)(e.mi,{children:"k"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"]"}),(0,i.jsx)(e.mo,{children:"="}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"K"}),(0,i.jsx)(e.mi,{children:"p"})]}),(0,i.jsx)(e.mi,{children:"e"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"["}),(0,i.jsx)(e.mi,{children:"k"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"]"}),(0,i.jsx)(e.mo,{children:"+"}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"K"}),(0,i.jsx)(e.mi,{children:"i"})]}),(0,i.jsxs)(e.msubsup,{children:[(0,i.jsx)(e.mo,{children:"\u2211"}),(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mi,{children:"i"}),(0,i.jsx)(e.mo,{children:"="}),(0,i.jsx)(e.mn,{children:"0"})]}),(0,i.jsx)(e.mi,{children:"k"})]}),(0,i.jsx)(e.mi,{children:"e"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"["}),(0,i.jsx)(e.mi,{children:"i"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"]"}),(0,i.jsx)(e.mi,{mathvariant:"normal",children:"\u0394"}),(0,i.jsx)(e.mi,{children:"t"}),(0,i.jsx)(e.mo,{children:"+"}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"K"}),(0,i.jsx)(e.mi,{children:"d"})]}),(0,i.jsxs)(e.mfrac,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mi,{children:"e"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"["}),(0,i.jsx)(e.mi,{children:"k"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"]"}),(0,i.jsx)(e.mo,{children:"\u2212"}),(0,i.jsx)(e.mi,{children:"e"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"["}),(0,i.jsx)(e.mi,{children:"k"}),(0,i.jsx)(e.mo,{children:"\u2212"}),(0,i.jsx)(e.mn,{children:"1"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"]"})]}),(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mi,{mathvariant:"normal",children:"\u0394"}),(0,i.jsx)(e.mi,{children:"t"})]})]})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"u[k] = K_p e[k] + K_i \\sum_{i=0}^{k} e[i] \\Delta t + K_d \\frac{e[k] - e[k-1]}{\\Delta t}"})]})})}),(0,i.jsxs)(e.span,{className:"katex-html","aria-hidden":"true",children:[(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",children:"u"}),(0,i.jsx)(e.span,{className:"mopen",children:"["}),(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.03148em"},children:"k"}),(0,i.jsx)(e.span,{className:"mclose",children:"]"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,i.jsx)(e.span,{className:"mrel",children:"="}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1.0361em",verticalAlign:"-0.2861em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"K"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.1514em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"p"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.2861em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mord mathnormal",children:"e"}),(0,i.jsx)(e.span,{className:"mopen",children:"["}),(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.03148em"},children:"k"}),(0,i.jsx)(e.span,{className:"mclose",children:"]"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,i.jsx)(e.span,{className:"mbin",children:"+"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1.2887em",verticalAlign:"-0.2997em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"K"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3117em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"i"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,i.jsxs)(e.span,{className:"mop",children:[(0,i.jsx)(e.span,{className:"mop op-symbol small-op",style:{position:"relative",top:"0em"},children:"\u2211"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsxs)(e.span,{className:"vlist",style:{height:"0.989em"},children:[(0,i.jsxs)(e.span,{style:{top:"-2.4003em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsxs)(e.span,{className:"mord mtight",children:[(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"i"}),(0,i.jsx)(e.span,{className:"mrel mtight",children:"="}),(0,i.jsx)(e.span,{className:"mord mtight",children:"0"})]})})]}),(0,i.jsxs)(e.span,{style:{top:"-3.2029em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",style:{marginRight:"0.03148em"},children:"k"})})})]})]}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.2997em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",children:"e"}),(0,i.jsx)(e.span,{className:"mopen",children:"["}),(0,i.jsx)(e.span,{className:"mord mathnormal",children:"i"}),(0,i.jsx)(e.span,{className:"mclose",children:"]"}),(0,i.jsx)(e.span,{className:"mord",children:"\u0394"}),(0,i.jsx)(e.span,{className:"mord mathnormal",children:"t"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,i.jsx)(e.span,{className:"mbin",children:"+"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1.355em",verticalAlign:"-0.345em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"K"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.3361em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"d"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mopen nulldelimiter"}),(0,i.jsx)(e.span,{className:"mfrac",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsxs)(e.span,{className:"vlist",style:{height:"1.01em"},children:[(0,i.jsxs)(e.span,{style:{top:"-2.655em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsxs)(e.span,{className:"mord mtight",children:[(0,i.jsx)(e.span,{className:"mord mtight",children:"\u0394"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"})]})})]}),(0,i.jsxs)(e.span,{style:{top:"-3.23em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"frac-line",style:{borderBottomWidth:"0.04em"}})]}),(0,i.jsxs)(e.span,{style:{top:"-3.485em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsxs)(e.span,{className:"mord mtight",children:[(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"e"}),(0,i.jsx)(e.span,{className:"mopen mtight",children:"["}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",style:{marginRight:"0.03148em"},children:"k"}),(0,i.jsx)(e.span,{className:"mclose mtight",children:"]"}),(0,i.jsx)(e.span,{className:"mbin mtight",children:"\u2212"}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"e"}),(0,i.jsx)(e.span,{className:"mopen mtight",children:"["}),(0,i.jsx)(e.span,{className:"mord mathnormal mtight",style:{marginRight:"0.03148em"},children:"k"}),(0,i.jsx)(e.span,{className:"mbin mtight",children:"\u2212"}),(0,i.jsx)(e.span,{className:"mord mtight",children:"1"}),(0,i.jsx)(e.span,{className:"mclose mtight",children:"]"})]})})]})]}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.345em"},children:(0,i.jsx)(e.span,{})})})]})}),(0,i.jsx)(e.span,{className:"mclose nulldelimiter"})]})]})]})]})}),"\n",(0,i.jsx)(e.h2,{id:"instructions",children:"Instructions"}),"\n",(0,i.jsx)(e.h3,{id:"step-1-set-up-the-simulation-environment",children:"Step 1: Set Up the Simulation Environment"}),"\n",(0,i.jsx)(e.p,{children:"Load the 2-DOF arm model and understand its structure:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:'import mujoco\nimport numpy as np\nimport matplotlib.pyplot as plt\n\n# Load model\nmodel = mujoco.MjModel.from_xml_path("textbook/assets/robot-models/mujoco/2dof-arm.xml")\ndata = mujoco.MjData(model)\n\n# Print model information\nprint(f"Number of joints: {model.njnt}")\nprint(f"Number of actuators: {model.nu}")\nprint(f"Simulation timestep: {model.opt.timestep}")\n\n# Get joint names and limits\nfor i in range(model.njnt):\n    name = mujoco.mj_id2name(model, mujoco.mjtObj.mjOBJ_JOINT, i)\n    jnt_range = model.jnt_range[i]\n    print(f"Joint {i} ({name}): range [{np.degrees(jnt_range[0]):.1f}, {np.degrees(jnt_range[1]):.1f}] deg")\n'})}),"\n",(0,i.jsx)("checkpoint",{children:(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Expected"}),": Model has 2 joints with reasonable range limits (e.g., \xb1180\xb0)."]})}),"\n",(0,i.jsx)(e.h3,{id:"step-2-implement-the-pid-controller-class",children:"Step 2: Implement the PID Controller Class"}),"\n",(0,i.jsx)(e.p,{children:"Create a reusable PID controller:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:'class PIDController:\n    """\n    Discrete PID controller with anti-windup.\n\n    Implements the parallel form:\n    u = Kp*e + Ki*integral(e) + Kd*derivative(e)\n    """\n\n    def __init__(self, kp, ki, kd, dt,\n                 output_limits=(-np.inf, np.inf),\n                 integral_limits=(-100, 100)):\n        """\n        Initialize PID controller.\n\n        Args:\n            kp: Proportional gain\n            ki: Integral gain\n            kd: Derivative gain\n            dt: Sample time (seconds)\n            output_limits: (min, max) for control output\n            integral_limits: (min, max) for anti-windup\n        """\n        self.kp = kp\n        self.ki = ki\n        self.kd = kd\n        self.dt = dt\n        self.output_limits = output_limits\n        self.integral_limits = integral_limits\n\n        # State variables\n        self.integral = 0.0\n        self.prev_error = 0.0\n        self.first_call = True\n\n    def reset(self):\n        """Reset controller state."""\n        self.integral = 0.0\n        self.prev_error = 0.0\n        self.first_call = True\n\n    def compute(self, setpoint, measurement):\n        """\n        Compute control output.\n\n        Args:\n            setpoint: Desired value\n            measurement: Current measured value\n\n        Returns:\n            Control output (torque command)\n        """\n        # Calculate error\n        error = setpoint - measurement\n\n        # Proportional term\n        p_term = self.kp * error\n\n        # Integral term with anti-windup\n        self.integral += error * self.dt\n        self.integral = np.clip(self.integral, *self.integral_limits)\n        i_term = self.ki * self.integral\n\n        # Derivative term (on error)\n        if self.first_call:\n            derivative = 0.0\n            self.first_call = False\n        else:\n            derivative = (error - self.prev_error) / self.dt\n        d_term = self.kd * derivative\n\n        self.prev_error = error\n\n        # Total output\n        output = p_term + i_term + d_term\n\n        # Apply output limits\n        output = np.clip(output, *self.output_limits)\n\n        return output, {\'p\': p_term, \'i\': i_term, \'d\': d_term, \'error\': error}\n\n# Create controller for one joint\ndt = model.opt.timestep\npid_joint0 = PIDController(kp=100, ki=10, kd=20, dt=dt, output_limits=(-50, 50))\n\nprint("PID controller created")\nprint(f"Gains: Kp={pid_joint0.kp}, Ki={pid_joint0.ki}, Kd={pid_joint0.kd}")\n'})}),"\n",(0,i.jsx)("checkpoint",{children:(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Expected"}),": PIDController class with proper initialization and methods."]})}),"\n",(0,i.jsx)(e.h3,{id:"step-3-control-a-single-joint",children:"Step 3: Control a Single Joint"}),"\n",(0,i.jsx)(e.p,{children:"Test the controller on joint 0:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"def run_single_joint_control(model, data, pid, target_angle, duration=3.0):\n    \"\"\"\n    Run PID control on joint 0.\n\n    Args:\n        model, data: MuJoCo model and data\n        pid: PIDController instance\n        target_angle: Desired joint angle (radians)\n        duration: Simulation duration (seconds)\n\n    Returns:\n        Dictionary with time series data\n    \"\"\"\n    dt = model.opt.timestep\n    n_steps = int(duration / dt)\n\n    # Storage\n    times = np.zeros(n_steps)\n    positions = np.zeros(n_steps)\n    velocities = np.zeros(n_steps)\n    torques = np.zeros(n_steps)\n    errors = np.zeros(n_steps)\n\n    # Reset\n    mujoco.mj_resetData(model, data)\n    pid.reset()\n\n    for i in range(n_steps):\n        # Get current state\n        current_angle = data.qpos[0]\n        current_vel = data.qvel[0]\n\n        # Compute control\n        torque, info = pid.compute(target_angle, current_angle)\n\n        # Apply torque\n        data.ctrl[0] = torque\n\n        # Store data\n        times[i] = data.time\n        positions[i] = current_angle\n        velocities[i] = current_vel\n        torques[i] = torque\n        errors[i] = info['error']\n\n        # Step simulation\n        mujoco.mj_step(model, data)\n\n    return {\n        'time': times,\n        'position': positions,\n        'velocity': velocities,\n        'torque': torques,\n        'error': errors,\n        'target': target_angle\n    }\n\n# Run control to target of 45 degrees\ntarget = np.radians(45)\nresult = run_single_joint_control(model, data, pid_joint0, target, duration=3.0)\n\n# Check final error\nfinal_error = np.degrees(result['error'][-1])\nprint(f\"Target: 45 deg, Final error: {final_error:.3f} deg\")\n"})}),"\n",(0,i.jsx)("checkpoint",{children:(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Expected"}),": Final error should be small (< 1 degree) with proper PID gains."]})}),"\n",(0,i.jsx)(e.h3,{id:"step-4-analyze-step-response",children:"Step 4: Analyze Step Response"}),"\n",(0,i.jsx)(e.p,{children:"Compute and visualize step response characteristics:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:'def analyze_step_response(time, response, target, settling_threshold=0.02):\n    """\n    Analyze step response characteristics.\n\n    Args:\n        time: Time array\n        response: System response array\n        target: Target/setpoint value\n        settling_threshold: Percentage for settling time (default 2%)\n\n    Returns:\n        Dictionary with rise time, overshoot, settling time, steady-state error\n    """\n    # Normalize response\n    initial = response[0]\n    final = response[-1]\n\n    # Rise time (10% to 90% of final value)\n    response_10 = initial + 0.1 * (target - initial)\n    response_90 = initial + 0.9 * (target - initial)\n\n    idx_10 = np.argmax(response >= response_10)\n    idx_90 = np.argmax(response >= response_90)\n\n```python\n```python\n    rise_time = time[idx_90] - time[idx_10] if idx_90 > idx_10 else 0\n'})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"\n    # Overshoot\n    peak = np.max(response)\n    overshoot = max(0, (peak - target) / (target - initial) * 100) if target != initial else 0\n\n    # Settling time (within threshold of final value)\n    settling_band = abs(target) * settling_threshold\n```python\n```python\n    settled = np.abs(response - target) <= settling_band\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"    if np.any(settled):\n        # Find first time it enters and stays in band\n        for i in range(len(settled)):\n            if np.all(settled[i:]):\n                settling_time = time[i]\n                break\n        else:\n            settling_time = time[-1]\n    else:\n        settling_time = time[-1]\n\n    # Steady-state error\n    steady_state_error = target - np.mean(response[-100:])\n\n    return {\n        'rise_time': rise_time,\n        'overshoot_percent': overshoot,\n        'settling_time': settling_time,\n        'steady_state_error': steady_state_error\n    }\n\n# Analyze the response\nmetrics = analyze_step_response(\n    result['time'],\n    result['position'],\n    target\n)\n\nprint(\"\\nStep Response Analysis:\")\nprint(f\"  Rise time: {metrics['rise_time']*1000:.1f} ms\")\nprint(f\"  Overshoot: {metrics['overshoot_percent']:.1f}%\")\nprint(f\"  Settling time: {metrics['settling_time']*1000:.1f} ms\")\nprint(f\"  Steady-state error: {np.degrees(metrics['steady_state_error']):.4f} deg\")\n"})}),"\n",(0,i.jsx)("checkpoint",{children:(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Expected"}),": Reasonable metrics - rise time < 500ms, overshoot < 30%, settling < 2s."]})}),"\n",(0,i.jsx)(e.h3,{id:"step-5-visualize-the-response",children:"Step 5: Visualize the Response"}),"\n",(0,i.jsx)(e.p,{children:"Create publication-quality plots:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"def plot_step_response(result, metrics):\n    \"\"\"Plot step response with annotations.\"\"\"\n    fig, axes = plt.subplots(3, 1, figsize=(12, 10), sharex=True)\n\n    time = result['time']\n    target_deg = np.degrees(result['target'])\n\n    # Position plot\n    axes[0].plot(time, np.degrees(result['position']), 'b-', linewidth=2, label='Actual')\n    axes[0].axhline(y=target_deg, color='r', linestyle='--', label='Target')\n    axes[0].axhline(y=target_deg * 0.98, color='g', linestyle=':', alpha=0.5)\n    axes[0].axhline(y=target_deg * 1.02, color='g', linestyle=':', alpha=0.5, label='\xb12% band')\n    axes[0].set_ylabel('Position (deg)')\n    axes[0].set_title(f'Step Response: Rise={metrics[\"rise_time\"]*1000:.0f}ms, '\n                      f'Overshoot={metrics[\"overshoot_percent\"]:.1f}%, '\n                      f'Settling={metrics[\"settling_time\"]*1000:.0f}ms')\n    axes[0].legend()\n    axes[0].grid(True)\n\n    # Velocity plot\n    axes[1].plot(time, np.degrees(result['velocity']), 'b-', linewidth=1.5)\n    axes[1].set_ylabel('Velocity (deg/s)')\n    axes[1].grid(True)\n\n    # Torque plot\n    axes[2].plot(time, result['torque'], 'b-', linewidth=1.5)\n    axes[2].set_xlabel('Time (s)')\n    axes[2].set_ylabel('Torque (Nm)')\n    axes[2].grid(True)\n\n    plt.tight_layout()\n    plt.savefig('pid_step_response.png', dpi=150)\n    plt.show()\n\nplot_step_response(result, metrics)\n"})}),"\n",(0,i.jsx)("checkpoint",{children:(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Expected"}),": Three-panel plot showing position, velocity, and torque over time."]})}),"\n",(0,i.jsx)(e.h3,{id:"step-6-tune-the-controller",children:"Step 6: Tune the Controller"}),"\n",(0,i.jsx)(e.p,{children:"Systematically vary gains to understand their effects:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:"def compare_gains(model, data, target, gain_sets, labels):\n    \"\"\"Compare different PID gain configurations.\"\"\"\n    fig, axes = plt.subplots(1, 2, figsize=(14, 5))\n\n    for (kp, ki, kd), label in zip(gain_sets, labels):\n        pid = PIDController(kp=kp, ki=ki, kd=kd, dt=model.opt.timestep, output_limits=(-50, 50))\n        result = run_single_joint_control(model, data, pid, target, duration=2.0)\n\n        axes[0].plot(result['time'], np.degrees(result['position']), label=label)\n        axes[1].plot(result['time'], result['torque'], label=label)\n\n    # Position plot\n    axes[0].axhline(y=np.degrees(target), color='k', linestyle='--', alpha=0.5)\n    axes[0].set_xlabel('Time (s)')\n    axes[0].set_ylabel('Position (deg)')\n    axes[0].set_title('Effect of PID Gains on Position Response')\n    axes[0].legend()\n    axes[0].grid(True)\n\n    # Torque plot\n    axes[1].set_xlabel('Time (s)')\n    axes[1].set_ylabel('Torque (Nm)')\n    axes[1].set_title('Effect of PID Gains on Control Effort')\n    axes[1].legend()\n    axes[1].grid(True)\n\n    plt.tight_layout()\n    plt.savefig('pid_gain_comparison.png', dpi=150)\n    plt.show()\n\n# Compare different gain configurations\ntarget = np.radians(45)\ngain_sets = [\n    (50, 0, 0),      # P only (underdamped)\n    (100, 0, 0),     # Higher P (more oscillation)\n    (100, 10, 0),    # P + I\n    (100, 10, 20),   # P + I + D (well-tuned)\n    (100, 10, 50),   # High D (overdamped)\n]\nlabels = ['Kp=50', 'Kp=100', 'Kp=100 Ki=10', 'Kp=100 Ki=10 Kd=20', 'Kp=100 Ki=10 Kd=50']\n\ncompare_gains(model, data, target, gain_sets, labels)\n"})}),"\n",(0,i.jsx)("checkpoint",{children:(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Expected"}),": Visual comparison showing how different gains affect response speed, overshoot, and damping."]})}),"\n",(0,i.jsx)(e.h2,{id:"expected-outcomes",children:"Expected Outcomes"}),"\n",(0,i.jsx)(e.p,{children:"After completing this lab, you should have:"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Code artifacts"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"pid_controller.py"}),": Reusable PID controller class"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"step_analysis.py"}),": Functions for analyzing step response"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Visual outputs"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"pid_step_response.png"}),": Annotated step response plot"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"pid_gain_comparison.png"}),": Gain tuning comparison"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Understanding"}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"How each PID term affects system behavior"}),"\n",(0,i.jsx)(e.li,{children:"Trade-offs between speed and stability"}),"\n",(0,i.jsx)(e.li,{children:"Systematic approaches to tuning"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"rubric",children:"Rubric"}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"Criterion"}),(0,i.jsx)(e.th,{children:"Points"}),(0,i.jsx)(e.th,{children:"Description"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"PID Implementation"}),(0,i.jsx)(e.td,{children:"25"}),(0,i.jsx)(e.td,{children:"Correct computation of P, I, D terms with anti-windup"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"Single Joint Control"}),(0,i.jsx)(e.td,{children:"20"}),(0,i.jsx)(e.td,{children:"Functional control loop achieving target position"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"Step Response Analysis"}),(0,i.jsx)(e.td,{children:"20"}),(0,i.jsx)(e.td,{children:"Correct computation of rise time, overshoot, settling time"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"Visualization"}),(0,i.jsx)(e.td,{children:"15"}),(0,i.jsx)(e.td,{children:"Clear, labeled plots with relevant information"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:"Gain Tuning"}),(0,i.jsx)(e.td,{children:"20"}),(0,i.jsx)(e.td,{children:"Systematic comparison showing gain effects"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"Total"})}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"100"})}),(0,i.jsx)(e.td,{})]})]})]}),"\n",(0,i.jsx)(e.h2,{id:"common-errors",children:"Common Errors"}),"\n",(0,i.jsxs)("troubleshooting",{children:[(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Error"}),": System oscillates indefinitely\n",(0,i.jsx)(e.strong,{children:"Solution"}),": Reduce Kp or increase Kd. High proportional gain without damping causes instability."]}),(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Error"}),": Large steady-state error\n",(0,i.jsx)(e.strong,{children:"Solution"}),": Add or increase Ki term. Pure P controllers have steady-state error under load."]}),(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Error"}),": Slow response\n",(0,i.jsx)(e.strong,{children:"Solution"}),": Increase Kp for faster response, but watch for overshoot."]}),(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Error"}),": Actuator saturation (torque clipping)\n",(0,i.jsx)(e.strong,{children:"Solution"}),": Reduce gains or increase output limits. Saturation causes integral windup."]})]}),"\n",(0,i.jsx)(e.h2,{id:"extensions",children:"Extensions"}),"\n",(0,i.jsx)(e.p,{children:"For advanced students:"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Multi-joint Control"}),": Extend to control both joints simultaneously"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Trajectory Tracking"}),": Follow a time-varying reference instead of step"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Derivative on Measurement"}),": Implement D term on measurement instead of error to avoid derivative kick"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Auto-tuning"}),": Implement Ziegler-Nichols or relay auto-tuning method"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"related-content",children:"Related Content"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Theory"}),": Module 05 theory.md, Section 5.2 (PID Control)"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Next Lab"}),": Lab 05-02 (Computed Torque Control)"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Application"}),": See Tesla Optimus case study for industrial motion control"]}),"\n"]})]})}function d(s={}){const{wrapper:e}={...(0,a.R)(),...s.components};return e?(0,i.jsx)(e,{...s,children:(0,i.jsx)(o,{...s})}):o(s)}},8453(s,e,n){n.d(e,{R:()=>l,x:()=>r});var t=n(6540);const i={},a=t.createContext(i);function l(s){const e=t.useContext(a);return t.useMemo(function(){return"function"==typeof s?s(e):{...e,...s}},[e,s])}function r(s){let e;return e=s.disableParentContext?"function"==typeof s.components?s.components(i):s.components||i:l(s.components),t.createElement(a.Provider,{value:e},s.children)}}}]);