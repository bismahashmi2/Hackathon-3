"use strict";(globalThis.webpackChunkmy_book=globalThis.webpackChunkmy_book||[]).push([[2121],{8453(e,s,n){n.d(s,{R:()=>l,x:()=>i});var t=n(6540);const a={},r=t.createContext(a);function l(e){const s=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),t.createElement(r.Provider,{value:s},e.children)}},9074(e,s,n){n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>i,default:()=>m,frontMatter:()=>l,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"textbook/modules/dynamics-control/labs/lab-05-02","title":"Computed Torque Control","description":"Objectives","source":"@site/docs/textbook/modules/05-dynamics-control/labs/lab-05-02.md","sourceDirName":"textbook/modules/05-dynamics-control/labs","slug":"/textbook/modules/dynamics-control/labs/lab-05-02","permalink":"/Hackathon-3/docs/textbook/modules/dynamics-control/labs/lab-05-02","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/textbook/modules/05-dynamics-control/labs/lab-05-02.md","tags":[],"version":"current","frontMatter":{"id":"lab-05-02","module_id":"05","title":"Computed Torque Control","difficulty":"intermediate","tier":"simulation","duration_minutes":90},"sidebar":"tutorialSidebar","previous":{"title":"Implementing PID Control for a 2-DOF Arm","permalink":"/Hackathon-3/docs/textbook/modules/dynamics-control/labs/lab-05-01"},"next":{"title":"Adaptive Control for Model Uncertainty","permalink":"/Hackathon-3/docs/textbook/modules/dynamics-control/labs/lab-05-03"}}');var a=n(4848),r=n(8453);const l={id:"lab-05-02",module_id:"05",title:"Computed Torque Control",difficulty:"intermediate",tier:"simulation",duration_minutes:90},i="Lab 05-02: Computed Torque Control",c={},o=[{value:"Objectives",id:"objectives",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Materials",id:"materials",level:2},{value:"Background",id:"background",level:2},{value:"Robot Dynamics Equation",id:"robot-dynamics-equation",level:3},{value:"Computed Torque Control",id:"computed-torque-control",level:3},{value:"Instructions",id:"instructions",level:2},{value:"Step 1: Access MuJoCo Dynamics Functions",id:"step-1-access-mujoco-dynamics-functions",level:3},{value:"Step 2: Implement Computed Torque Controller",id:"step-2-implement-computed-torque-controller",level:3},{value:"Step 3: Run Position Control",id:"step-3-run-position-control",level:3},{value:"Step 4: Compare with PID Control",id:"step-4-compare-with-pid-control",level:3},{value:"Step 5: Visualize Comparison",id:"step-5-visualize-comparison",level:3},{value:"Step 6: Test Trajectory Tracking",id:"step-6-test-trajectory-tracking",level:3},{value:"Expected Outcomes",id:"expected-outcomes",level:2},{value:"Rubric",id:"rubric",level:2},{value:"Common Errors",id:"common-errors",level:2},{value:"Extensions",id:"extensions",level:2},{value:"Related Content",id:"related-content",level:2}];function d(e){const s={annotation:"annotation",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",math:"math",mi:"mi",mo:"mo",mover:"mover",mrow:"mrow",msub:"msub",ol:"ol",p:"p",pre:"pre",semantics:"semantics",span:"span",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.header,{children:(0,a.jsx)(s.h1,{id:"lab-05-02-computed-torque-control",children:"Lab 05-02: Computed Torque Control"})}),"\n",(0,a.jsx)(s.h2,{id:"objectives",children:"Objectives"}),"\n",(0,a.jsx)(s.p,{children:"By the end of this lab, you will be able to:"}),"\n",(0,a.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,a.jsxs)(s.li,{className:"task-list-item",children:[(0,a.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Understand the robot dynamics equation and its components"]}),"\n",(0,a.jsxs)(s.li,{className:"task-list-item",children:[(0,a.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Implement computed torque (inverse dynamics) control"]}),"\n",(0,a.jsxs)(s.li,{className:"task-list-item",children:[(0,a.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Compare computed torque to PID control performance"]}),"\n",(0,a.jsxs)(s.li,{className:"task-list-item",children:[(0,a.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Handle model uncertainty and its effects on control"]}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"Completed Lab 05-01 (PID Control)"}),"\n",(0,a.jsx)(s.li,{children:"Understanding of rigid body dynamics (Module 02)"}),"\n",(0,a.jsx)(s.li,{children:"Matrix algebra with NumPy"}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"materials",children:"Materials"}),"\n",(0,a.jsxs)(s.table,{children:[(0,a.jsx)(s.thead,{children:(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.th,{children:"Type"}),(0,a.jsx)(s.th,{children:"Name"}),(0,a.jsx)(s.th,{children:"Tier"}),(0,a.jsx)(s.th,{children:"Notes"})]})}),(0,a.jsxs)(s.tbody,{children:[(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:"software"}),(0,a.jsx)(s.td,{children:"MuJoCo 3.0+"}),(0,a.jsx)(s.td,{children:"required"}),(0,a.jsx)(s.td,{children:"Physics simulation"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:"software"}),(0,a.jsx)(s.td,{children:"Python 3.10+"}),(0,a.jsx)(s.td,{children:"required"}),(0,a.jsx)(s.td,{children:"Programming environment"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:"software"}),(0,a.jsx)(s.td,{children:"NumPy, Matplotlib"}),(0,a.jsx)(s.td,{children:"required"}),(0,a.jsx)(s.td,{children:"Computation and visualization"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:"simulation"}),(0,a.jsx)(s.td,{children:"2dof-arm.xml"}),(0,a.jsx)(s.td,{children:"required"}),(0,a.jsx)(s.td,{children:"Two-link planar arm model"})]})]})]}),"\n",(0,a.jsx)(s.h2,{id:"background",children:"Background"}),"\n",(0,a.jsx)(s.h3,{id:"robot-dynamics-equation",children:"Robot Dynamics Equation"}),"\n",(0,a.jsx)(s.p,{children:"The manipulator dynamics are described by:"}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsxs)(s.mrow,{children:[(0,a.jsx)(s.mi,{children:"M"}),(0,a.jsx)(s.mo,{stretchy:"false",children:"("}),(0,a.jsx)(s.mi,{children:"q"}),(0,a.jsx)(s.mo,{stretchy:"false",children:")"}),(0,a.jsxs)(s.mover,{accent:"true",children:[(0,a.jsx)(s.mi,{children:"q"}),(0,a.jsx)(s.mo,{children:"\xa8"})]}),(0,a.jsx)(s.mo,{children:"+"}),(0,a.jsx)(s.mi,{children:"C"}),(0,a.jsx)(s.mo,{stretchy:"false",children:"("}),(0,a.jsx)(s.mi,{children:"q"}),(0,a.jsx)(s.mo,{separator:"true",children:","}),(0,a.jsxs)(s.mover,{accent:"true",children:[(0,a.jsx)(s.mi,{children:"q"}),(0,a.jsx)(s.mo,{children:"\u02d9"})]}),(0,a.jsx)(s.mo,{stretchy:"false",children:")"}),(0,a.jsxs)(s.mover,{accent:"true",children:[(0,a.jsx)(s.mi,{children:"q"}),(0,a.jsx)(s.mo,{children:"\u02d9"})]}),(0,a.jsx)(s.mo,{children:"+"}),(0,a.jsx)(s.mi,{children:"g"}),(0,a.jsx)(s.mo,{stretchy:"false",children:"("}),(0,a.jsx)(s.mi,{children:"q"}),(0,a.jsx)(s.mo,{stretchy:"false",children:")"}),(0,a.jsx)(s.mo,{children:"="}),(0,a.jsx)(s.mi,{children:"\u03c4"})]}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"M(q)\\ddot{q} + C(q, \\dot{q})\\dot{q} + g(q) = \\tau"})]})})}),(0,a.jsxs)(s.span,{className:"katex-html","aria-hidden":"true",children:[(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.10903em"},children:"M"}),(0,a.jsx)(s.span,{className:"mopen",children:"("}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"q"}),(0,a.jsx)(s.span,{className:"mclose",children:")"}),(0,a.jsx)(s.span,{className:"mord accent",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsxs)(s.span,{className:"vlist",style:{height:"0.6679em"},children:[(0,a.jsxs)(s.span,{style:{top:"-3em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"q"})]}),(0,a.jsxs)(s.span,{style:{top:"-3em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,a.jsx)(s.span,{className:"accent-body",style:{left:"-0.1667em"},children:(0,a.jsx)(s.span,{className:"mord",children:"\xa8"})})]})]}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.1944em"},children:(0,a.jsx)(s.span,{})})})]})}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,a.jsx)(s.span,{className:"mbin",children:"+"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"C"}),(0,a.jsx)(s.span,{className:"mopen",children:"("}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"q"}),(0,a.jsx)(s.span,{className:"mpunct",children:","}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,a.jsx)(s.span,{className:"mord accent",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsxs)(s.span,{className:"vlist",style:{height:"0.6679em"},children:[(0,a.jsxs)(s.span,{style:{top:"-3em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"q"})]}),(0,a.jsxs)(s.span,{style:{top:"-3em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,a.jsx)(s.span,{className:"accent-body",style:{left:"-0.0556em"},children:(0,a.jsx)(s.span,{className:"mord",children:"\u02d9"})})]})]}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.1944em"},children:(0,a.jsx)(s.span,{})})})]})}),(0,a.jsx)(s.span,{className:"mclose",children:")"}),(0,a.jsx)(s.span,{className:"mord accent",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsxs)(s.span,{className:"vlist",style:{height:"0.6679em"},children:[(0,a.jsxs)(s.span,{style:{top:"-3em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"q"})]}),(0,a.jsxs)(s.span,{style:{top:"-3em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,a.jsx)(s.span,{className:"accent-body",style:{left:"-0.0556em"},children:(0,a.jsx)(s.span,{className:"mord",children:"\u02d9"})})]})]}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.1944em"},children:(0,a.jsx)(s.span,{})})})]})}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,a.jsx)(s.span,{className:"mbin",children:"+"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"g"}),(0,a.jsx)(s.span,{className:"mopen",children:"("}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"q"}),(0,a.jsx)(s.span,{className:"mclose",children:")"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,a.jsx)(s.span,{className:"mrel",children:"="}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.4306em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.1132em"},children:"\u03c4"})]})]})]})}),"\n",(0,a.jsx)(s.p,{children:"Where:"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsxs)(s.mrow,{children:[(0,a.jsx)(s.mi,{children:"M"}),(0,a.jsx)(s.mo,{stretchy:"false",children:"("}),(0,a.jsx)(s.mi,{children:"q"}),(0,a.jsx)(s.mo,{stretchy:"false",children:")"})]}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"M(q)"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.10903em"},children:"M"}),(0,a.jsx)(s.span,{className:"mopen",children:"("}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"q"}),(0,a.jsx)(s.span,{className:"mclose",children:")"})]})})]}),": Mass/inertia matrix (n\xd7n)"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsxs)(s.mrow,{children:[(0,a.jsx)(s.mi,{children:"C"}),(0,a.jsx)(s.mo,{stretchy:"false",children:"("}),(0,a.jsx)(s.mi,{children:"q"}),(0,a.jsx)(s.mo,{separator:"true",children:","}),(0,a.jsxs)(s.mover,{accent:"true",children:[(0,a.jsx)(s.mi,{children:"q"}),(0,a.jsx)(s.mo,{children:"\u02d9"})]}),(0,a.jsx)(s.mo,{stretchy:"false",children:")"})]}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"C(q, \\dot{q})"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"C"}),(0,a.jsx)(s.span,{className:"mopen",children:"("}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"q"}),(0,a.jsx)(s.span,{className:"mpunct",children:","}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,a.jsx)(s.span,{className:"mord accent",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsxs)(s.span,{className:"vlist",style:{height:"0.6679em"},children:[(0,a.jsxs)(s.span,{style:{top:"-3em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"q"})]}),(0,a.jsxs)(s.span,{style:{top:"-3em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,a.jsx)(s.span,{className:"accent-body",style:{left:"-0.0556em"},children:(0,a.jsx)(s.span,{className:"mord",children:"\u02d9"})})]})]}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.1944em"},children:(0,a.jsx)(s.span,{})})})]})}),(0,a.jsx)(s.span,{className:"mclose",children:")"})]})})]}),": Coriolis and centrifugal matrix"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsxs)(s.mrow,{children:[(0,a.jsx)(s.mi,{children:"g"}),(0,a.jsx)(s.mo,{stretchy:"false",children:"("}),(0,a.jsx)(s.mi,{children:"q"}),(0,a.jsx)(s.mo,{stretchy:"false",children:")"})]}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"g(q)"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"g"}),(0,a.jsx)(s.span,{className:"mopen",children:"("}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"q"}),(0,a.jsx)(s.span,{className:"mclose",children:")"})]})})]}),": Gravity vector"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsx)(s.mrow,{children:(0,a.jsx)(s.mi,{children:"\u03c4"})}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"\\tau"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.4306em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.1132em"},children:"\u03c4"})]})})]}),": Joint torques"]}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"computed-torque-control",children:"Computed Torque Control"}),"\n",(0,a.jsx)(s.p,{children:"The idea is to use a model of the robot to compute the torque that would achieve desired accelerations:"}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsxs)(s.mrow,{children:[(0,a.jsx)(s.mi,{children:"\u03c4"}),(0,a.jsx)(s.mo,{children:"="}),(0,a.jsx)(s.mi,{children:"M"}),(0,a.jsx)(s.mo,{stretchy:"false",children:"("}),(0,a.jsx)(s.mi,{children:"q"}),(0,a.jsx)(s.mo,{stretchy:"false",children:")"}),(0,a.jsx)(s.mo,{stretchy:"false",children:"("}),(0,a.jsxs)(s.msub,{children:[(0,a.jsxs)(s.mover,{accent:"true",children:[(0,a.jsx)(s.mi,{children:"q"}),(0,a.jsx)(s.mo,{children:"\xa8"})]}),(0,a.jsx)(s.mi,{children:"d"})]}),(0,a.jsx)(s.mo,{children:"+"}),(0,a.jsxs)(s.msub,{children:[(0,a.jsx)(s.mi,{children:"K"}),(0,a.jsx)(s.mi,{children:"d"})]}),(0,a.jsxs)(s.mover,{accent:"true",children:[(0,a.jsx)(s.mi,{children:"e"}),(0,a.jsx)(s.mo,{children:"\u02d9"})]}),(0,a.jsx)(s.mo,{children:"+"}),(0,a.jsxs)(s.msub,{children:[(0,a.jsx)(s.mi,{children:"K"}),(0,a.jsx)(s.mi,{children:"p"})]}),(0,a.jsx)(s.mi,{children:"e"}),(0,a.jsx)(s.mo,{stretchy:"false",children:")"}),(0,a.jsx)(s.mo,{children:"+"}),(0,a.jsx)(s.mi,{children:"C"}),(0,a.jsx)(s.mo,{stretchy:"false",children:"("}),(0,a.jsx)(s.mi,{children:"q"}),(0,a.jsx)(s.mo,{separator:"true",children:","}),(0,a.jsxs)(s.mover,{accent:"true",children:[(0,a.jsx)(s.mi,{children:"q"}),(0,a.jsx)(s.mo,{children:"\u02d9"})]}),(0,a.jsx)(s.mo,{stretchy:"false",children:")"}),(0,a.jsxs)(s.mover,{accent:"true",children:[(0,a.jsx)(s.mi,{children:"q"}),(0,a.jsx)(s.mo,{children:"\u02d9"})]}),(0,a.jsx)(s.mo,{children:"+"}),(0,a.jsx)(s.mi,{children:"g"}),(0,a.jsx)(s.mo,{stretchy:"false",children:"("}),(0,a.jsx)(s.mi,{children:"q"}),(0,a.jsx)(s.mo,{stretchy:"false",children:")"})]}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"\\tau = M(q)(\\ddot{q}_d + K_d \\dot{e} + K_p e) + C(q, \\dot{q})\\dot{q} + g(q)"})]})})}),(0,a.jsxs)(s.span,{className:"katex-html","aria-hidden":"true",children:[(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.4306em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.1132em"},children:"\u03c4"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,a.jsx)(s.span,{className:"mrel",children:"="}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.10903em"},children:"M"}),(0,a.jsx)(s.span,{className:"mopen",children:"("}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"q"}),(0,a.jsx)(s.span,{className:"mclose",children:")"}),(0,a.jsx)(s.span,{className:"mopen",children:"("}),(0,a.jsxs)(s.span,{className:"mord",children:[(0,a.jsx)(s.span,{className:"mord accent",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsxs)(s.span,{className:"vlist",style:{height:"0.6679em"},children:[(0,a.jsxs)(s.span,{style:{top:"-3em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"q"})]}),(0,a.jsxs)(s.span,{style:{top:"-3em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,a.jsx)(s.span,{className:"accent-body",style:{left:"-0.1667em"},children:(0,a.jsx)(s.span,{className:"mord",children:"\xa8"})})]})]}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.1944em"},children:(0,a.jsx)(s.span,{})})})]})}),(0,a.jsx)(s.span,{className:"msupsub",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.3361em"},children:(0,a.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"-0.0359em",marginRight:"0.05em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,a.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,a.jsx)(s.span,{className:"mord mathnormal mtight",children:"d"})})]})}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.15em"},children:(0,a.jsx)(s.span,{})})})]})})]}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,a.jsx)(s.span,{className:"mbin",children:"+"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.8333em",verticalAlign:"-0.15em"}}),(0,a.jsxs)(s.span,{className:"mord",children:[(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"K"}),(0,a.jsx)(s.span,{className:"msupsub",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.3361em"},children:(0,a.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,a.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,a.jsx)(s.span,{className:"mord mathnormal mtight",children:"d"})})]})}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.15em"},children:(0,a.jsx)(s.span,{})})})]})})]}),(0,a.jsx)(s.span,{className:"mord accent",children:(0,a.jsx)(s.span,{className:"vlist-t",children:(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsxs)(s.span,{className:"vlist",style:{height:"0.6679em"},children:[(0,a.jsxs)(s.span,{style:{top:"-3em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"e"})]}),(0,a.jsxs)(s.span,{style:{top:"-3em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,a.jsx)(s.span,{className:"accent-body",style:{left:"-0.0833em"},children:(0,a.jsx)(s.span,{className:"mord",children:"\u02d9"})})]})]})})})}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,a.jsx)(s.span,{className:"mbin",children:"+"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"1.0361em",verticalAlign:"-0.2861em"}}),(0,a.jsxs)(s.span,{className:"mord",children:[(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"K"}),(0,a.jsx)(s.span,{className:"msupsub",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.1514em"},children:(0,a.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,a.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,a.jsx)(s.span,{className:"mord mathnormal mtight",children:"p"})})]})}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.2861em"},children:(0,a.jsx)(s.span,{})})})]})})]}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"e"}),(0,a.jsx)(s.span,{className:"mclose",children:")"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,a.jsx)(s.span,{className:"mbin",children:"+"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"C"}),(0,a.jsx)(s.span,{className:"mopen",children:"("}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"q"}),(0,a.jsx)(s.span,{className:"mpunct",children:","}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,a.jsx)(s.span,{className:"mord accent",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsxs)(s.span,{className:"vlist",style:{height:"0.6679em"},children:[(0,a.jsxs)(s.span,{style:{top:"-3em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"q"})]}),(0,a.jsxs)(s.span,{style:{top:"-3em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,a.jsx)(s.span,{className:"accent-body",style:{left:"-0.0556em"},children:(0,a.jsx)(s.span,{className:"mord",children:"\u02d9"})})]})]}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.1944em"},children:(0,a.jsx)(s.span,{})})})]})}),(0,a.jsx)(s.span,{className:"mclose",children:")"}),(0,a.jsx)(s.span,{className:"mord accent",children:(0,a.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,a.jsxs)(s.span,{className:"vlist-r",children:[(0,a.jsxs)(s.span,{className:"vlist",style:{height:"0.6679em"},children:[(0,a.jsxs)(s.span,{style:{top:"-3em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"q"})]}),(0,a.jsxs)(s.span,{style:{top:"-3em"},children:[(0,a.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,a.jsx)(s.span,{className:"accent-body",style:{left:"-0.0556em"},children:(0,a.jsx)(s.span,{className:"mord",children:"\u02d9"})})]})]}),(0,a.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,a.jsx)(s.span,{className:"vlist-r",children:(0,a.jsx)(s.span,{className:"vlist",style:{height:"0.1944em"},children:(0,a.jsx)(s.span,{})})})]})}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,a.jsx)(s.span,{className:"mbin",children:"+"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"g"}),(0,a.jsx)(s.span,{className:"mopen",children:"("}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"q"}),(0,a.jsx)(s.span,{className:"mclose",children:")"})]})]})]})}),"\n",(0,a.jsx)(s.p,{children:"This linearizes the system, allowing simple PD control to achieve desired dynamics."}),"\n",(0,a.jsx)(s.h2,{id:"instructions",children:"Instructions"}),"\n",(0,a.jsx)(s.h3,{id:"step-1-access-mujoco-dynamics-functions",children:"Step 1: Access MuJoCo Dynamics Functions"}),"\n",(0,a.jsx)(s.p,{children:"MuJoCo provides the dynamics matrices we need:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-python",children:'import mujoco\nimport numpy as np\nimport matplotlib.pyplot as plt\n\n# Load model\nmodel = mujoco.MjModel.from_xml_path("textbook/assets/robot-models/mujoco/2dof-arm.xml")\ndata = mujoco.MjData(model)\n\ndef get_dynamics_matrices(model, data):\n    """\n    Extract dynamics matrices from MuJoCo.\n\n    Returns:\n        M: Mass matrix (nv x nv)\n        bias: Coriolis + gravity forces (nv,)\n    """\n    nv = model.nv  # Number of velocity DOFs\n\n    # Mass matrix\n    M = np.zeros((nv, nv))\n    mujoco.mj_fullM(model, M, data.qM)\n\n    # Bias forces (Coriolis + centrifugal + gravity)\n    # data.qfrc_bias contains these after mj_forward()\n    mujoco.mj_forward(model, data)\n    bias = data.qfrc_bias.copy()\n\n    return M, bias\n\n# Test\nmujoco.mj_resetData(model, data)\ndata.qpos[:] = [0.5, 0.3]  # Set some joint positions\ndata.qvel[:] = [0.1, -0.2]  # Set some velocities\n\nM, bias = get_dynamics_matrices(model, data)\nprint(f"Mass matrix M:\\n{M}")\nprint(f"Bias forces (C*qdot + g): {bias}")\n'})}),"\n",(0,a.jsx)("checkpoint",{children:(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Expected"}),": Mass matrix should be symmetric positive definite. Bias forces should be non-zero due to gravity."]})}),"\n",(0,a.jsx)(s.h3,{id:"step-2-implement-computed-torque-controller",children:"Step 2: Implement Computed Torque Controller"}),"\n",(0,a.jsx)(s.p,{children:"Create the controller using inverse dynamics:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-python",children:'class ComputedTorqueController:\n    """\n    Computed torque (inverse dynamics) controller.\n\n    Computes: \u03c4 = M(q)(q\u0308_d + Kd*\u0117 + Kp*e) + C(q,q\u0307)q\u0307 + g(q)\n    """\n\n    def __init__(self, model, kp, kd):\n        """\n        Initialize controller.\n\n        Args:\n            model: MuJoCo model\n            kp: Position gain (scalar or array)\n            kd: Velocity gain (scalar or array)\n        """\n        self.model = model\n        self.nv = model.nv\n\n        # Convert gains to arrays\n        self.kp = np.atleast_1d(kp) * np.ones(self.nv)\n        self.kd = np.atleast_1d(kd) * np.ones(self.nv)\n\n    def compute(self, data, q_desired, qd_desired, qdd_desired=None):\n        """\n        Compute control torque.\n\n        Args:\n            data: MuJoCo data (contains current state)\n            q_desired: Desired positions\n            qd_desired: Desired velocities\n            qdd_desired: Desired accelerations (default zeros)\n\n        Returns:\n            tau: Joint torques\n            info: Dictionary with debug information\n        """\n        if qdd_desired is None:\n            qdd_desired = np.zeros(self.nv)\n\n        # Current state\n        q = data.qpos[:self.nv].copy()\n        qd = data.qvel[:self.nv].copy()\n\n        # Errors\n        e = q_desired - q\n        ed = qd_desired - qd\n\n        # Desired acceleration with feedback\n        qdd_command = qdd_desired + self.kd * ed + self.kp * e\n\n        # Get dynamics matrices\n        M, bias = get_dynamics_matrices(self.model, data)\n\n        # Computed torque: \u03c4 = M*q\u0308_command + bias\n        tau = M @ qdd_command + bias\n\n        info = {\n            \'error\': e,\n            \'error_dot\': ed,\n            \'qdd_command\': qdd_command,\n            \'M\': M,\n            \'bias\': bias\n        }\n\n        return tau, info\n\n# Create controller\nkp = 100  # Position gain\nkd = 20   # Velocity gain (typically 2*sqrt(kp) for critical damping)\nctc = ComputedTorqueController(model, kp, kd)\n\nprint(f"Computed Torque Controller created")\nprint(f"Gains: Kp={ctc.kp}, Kd={ctc.kd}")\n'})}),"\n",(0,a.jsx)("checkpoint",{children:(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Expected"}),": Controller created with proper gain arrays."]})}),"\n",(0,a.jsx)(s.h3,{id:"step-3-run-position-control",children:"Step 3: Run Position Control"}),"\n",(0,a.jsx)(s.p,{children:"Test the controller on a setpoint regulation task:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-python",children:"def run_computed_torque_control(model, data, controller, q_target, duration=3.0):\n    \"\"\"\n    Run computed torque control to reach a target position.\n\n    Args:\n        model, data: MuJoCo model and data\n        controller: ComputedTorqueController instance\n        q_target: Target joint positions\n        duration: Simulation duration\n\n    Returns:\n        Dictionary with time series data\n    \"\"\"\n    dt = model.opt.timestep\n    n_steps = int(duration / dt)\n    nv = model.nv\n\n    # Storage\n    results = {\n        'time': np.zeros(n_steps),\n        'position': np.zeros((n_steps, nv)),\n        'velocity': np.zeros((n_steps, nv)),\n        'torque': np.zeros((n_steps, nv)),\n        'error': np.zeros((n_steps, nv))\n    }\n\n    # Reset simulation\n    mujoco.mj_resetData(model, data)\n\n    # Desired state (stationary at target)\n    q_desired = np.array(q_target)\n    qd_desired = np.zeros(nv)\n\n    for i in range(n_steps):\n        # Compute control\n        tau, info = controller.compute(data, q_desired, qd_desired)\n\n        # Apply torque\n        data.ctrl[:nv] = tau\n\n        # Store data\n        results['time'][i] = data.time\n        results['position'][i] = data.qpos[:nv].copy()\n        results['velocity'][i] = data.qvel[:nv].copy()\n        results['torque'][i] = tau.copy()\n        results['error'][i] = info['error'].copy()\n\n        # Step simulation\n        mujoco.mj_step(model, data)\n\n    return results\n\n# Run to target position\ntarget = np.array([np.radians(45), np.radians(-30)])\nresults_ctc = run_computed_torque_control(model, data, ctc, target)\n\n# Check performance\nfinal_error = np.degrees(results_ctc['error'][-1])\nprint(f\"Target: {np.degrees(target)} deg\")\nprint(f\"Final error: {final_error} deg\")\n"})}),"\n",(0,a.jsx)("checkpoint",{children:(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Expected"}),": Very small final errors (< 0.1 degree) due to model-based compensation."]})}),"\n",(0,a.jsx)(s.h3,{id:"step-4-compare-with-pid-control",children:"Step 4: Compare with PID Control"}),"\n",(0,a.jsx)(s.p,{children:"Run the same task with PID for comparison:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-python",children:"# Import PID from Lab 05-01\nclass PIDController:\n    def __init__(self, kp, ki, kd, dt, output_limits=(-np.inf, np.inf)):\n        self.kp, self.ki, self.kd, self.dt = kp, ki, kd, dt\n        self.output_limits = output_limits\n        self.integral = 0.0\n        self.prev_error = 0.0\n        self.first_call = True\n\n    def reset(self):\n        self.integral = 0.0\n        self.prev_error = 0.0\n        self.first_call = True\n\n    def compute(self, setpoint, measurement):\n        error = setpoint - measurement\n        p_term = self.kp * error\n        self.integral += error * self.dt\n        i_term = self.ki * self.integral\n        d_term = 0 if self.first_call else self.kd * (error - self.prev_error) / self.dt\n        self.first_call = False\n        self.prev_error = error\n        output = np.clip(p_term + i_term + d_term, *self.output_limits)\n        return output\n\ndef run_pid_control_2dof(model, data, pid_list, q_target, duration=3.0):\n    \"\"\"Run independent PID control on each joint.\"\"\"\n    dt = model.opt.timestep\n    n_steps = int(duration / dt)\n    nv = model.nv\n\n    results = {\n        'time': np.zeros(n_steps),\n        'position': np.zeros((n_steps, nv)),\n        'velocity': np.zeros((n_steps, nv)),\n        'torque': np.zeros((n_steps, nv)),\n        'error': np.zeros((n_steps, nv))\n    }\n\n    mujoco.mj_resetData(model, data)\n    for pid in pid_list:\n        pid.reset()\n\n    for i in range(n_steps):\n        tau = np.zeros(nv)\n        for j in range(nv):\n            tau[j] = pid_list[j].compute(q_target[j], data.qpos[j])\n\n        data.ctrl[:nv] = tau\n\n        results['time'][i] = data.time\n        results['position'][i] = data.qpos[:nv].copy()\n        results['velocity'][i] = data.qvel[:nv].copy()\n        results['torque'][i] = tau.copy()\n        results['error'][i] = q_target - data.qpos[:nv]\n\n        mujoco.mj_step(model, data)\n\n    return results\n\n# Create PID controllers (tuned for similar response)\npid_list = [\n    PIDController(kp=100, ki=10, kd=20, dt=model.opt.timestep, output_limits=(-50, 50)),\n    PIDController(kp=80, ki=8, kd=16, dt=model.opt.timestep, output_limits=(-30, 30))\n]\n\nresults_pid = run_pid_control_2dof(model, data, pid_list, target)\n\n# Compare\nprint(\"\\nPerformance Comparison:\")\nprint(f\"CTC final error: {np.degrees(results_ctc['error'][-1])} deg\")\nprint(f\"PID final error: {np.degrees(results_pid['error'][-1])} deg\")\n"})}),"\n",(0,a.jsx)("checkpoint",{children:(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Expected"}),": CTC should achieve better performance, especially in coupled dynamics."]})}),"\n",(0,a.jsx)(s.h3,{id:"step-5-visualize-comparison",children:"Step 5: Visualize Comparison"}),"\n",(0,a.jsx)(s.p,{children:"Create comparison plots:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-python",children:"def plot_comparison(results_ctc, results_pid, target):\n    \"\"\"Plot CTC vs PID comparison.\"\"\"\n    fig, axes = plt.subplots(2, 2, figsize=(14, 10))\n\n    # Joint 0 position\n    axes[0, 0].plot(results_ctc['time'], np.degrees(results_ctc['position'][:, 0]),\n                    'b-', linewidth=2, label='CTC')\n    axes[0, 0].plot(results_pid['time'], np.degrees(results_pid['position'][:, 0]),\n                    'r--', linewidth=2, label='PID')\n    axes[0, 0].axhline(y=np.degrees(target[0]), color='k', linestyle=':', alpha=0.5)\n    axes[0, 0].set_ylabel('Position (deg)')\n    axes[0, 0].set_title('Joint 0 Position')\n    axes[0, 0].legend()\n    axes[0, 0].grid(True)\n\n    # Joint 1 position\n    axes[0, 1].plot(results_ctc['time'], np.degrees(results_ctc['position'][:, 1]),\n                    'b-', linewidth=2, label='CTC')\n    axes[0, 1].plot(results_pid['time'], np.degrees(results_pid['position'][:, 1]),\n                    'r--', linewidth=2, label='PID')\n    axes[0, 1].axhline(y=np.degrees(target[1]), color='k', linestyle=':', alpha=0.5)\n    axes[0, 1].set_ylabel('Position (deg)')\n    axes[0, 1].set_title('Joint 1 Position')\n    axes[0, 1].legend()\n    axes[0, 1].grid(True)\n\n    # Joint 0 torque\n    axes[1, 0].plot(results_ctc['time'], results_ctc['torque'][:, 0],\n                    'b-', linewidth=1.5, label='CTC')\n    axes[1, 0].plot(results_pid['time'], results_pid['torque'][:, 0],\n                    'r--', linewidth=1.5, label='PID')\n    axes[1, 0].set_xlabel('Time (s)')\n    axes[1, 0].set_ylabel('Torque (Nm)')\n    axes[1, 0].set_title('Joint 0 Torque')\n    axes[1, 0].legend()\n    axes[1, 0].grid(True)\n\n    # Joint 1 torque\n    axes[1, 1].plot(results_ctc['time'], results_ctc['torque'][:, 1],\n                    'b-', linewidth=1.5, label='CTC')\n    axes[1, 1].plot(results_pid['time'], results_pid['torque'][:, 1],\n                    'r--', linewidth=1.5, label='PID')\n    axes[1, 1].set_xlabel('Time (s)')\n    axes[1, 1].set_ylabel('Torque (Nm)')\n    axes[1, 1].set_title('Joint 1 Torque')\n    axes[1, 1].legend()\n    axes[1, 1].grid(True)\n\n    plt.tight_layout()\n    plt.savefig('ctc_vs_pid.png', dpi=150)\n    plt.show()\n\nplot_comparison(results_ctc, results_pid, target)\n"})}),"\n",(0,a.jsx)("checkpoint",{children:(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Expected"}),": Plots showing CTC with faster settling and better decoupling between joints."]})}),"\n",(0,a.jsx)(s.h3,{id:"step-6-test-trajectory-tracking",children:"Step 6: Test Trajectory Tracking"}),"\n",(0,a.jsx)(s.p,{children:"Evaluate tracking performance on a sinusoidal trajectory:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-python",children:"def generate_trajectory(t, amplitude=0.5, frequency=0.5):\n    \"\"\"Generate sinusoidal joint trajectory.\"\"\"\n    q = amplitude * np.sin(2 * np.pi * frequency * t)\n    qd = amplitude * 2 * np.pi * frequency * np.cos(2 * np.pi * frequency * t)\n    qdd = -amplitude * (2 * np.pi * frequency)**2 * np.sin(2 * np.pi * frequency * t)\n    return q, qd, qdd\n\ndef run_trajectory_tracking(model, data, controller, duration=5.0):\n    \"\"\"Run trajectory tracking with computed torque.\"\"\"\n    dt = model.opt.timestep\n    n_steps = int(duration / dt)\n    nv = model.nv\n\n    results = {\n        'time': np.zeros(n_steps),\n        'position': np.zeros((n_steps, nv)),\n        'desired': np.zeros((n_steps, nv)),\n        'error': np.zeros((n_steps, nv)),\n        'torque': np.zeros((n_steps, nv))\n    }\n\n    mujoco.mj_resetData(model, data)\n\n    for i in range(n_steps):\n        t = i * dt\n\n        # Generate trajectory for both joints (with phase offset)\n        q1, qd1, qdd1 = generate_trajectory(t, amplitude=0.6, frequency=0.3)\n        q2, qd2, qdd2 = generate_trajectory(t + 0.5, amplitude=0.4, frequency=0.5)\n\n        q_desired = np.array([q1, q2])\n        qd_desired = np.array([qd1, qd2])\n        qdd_desired = np.array([qdd1, qdd2])\n\n        # Compute control with feedforward acceleration\n        tau, info = controller.compute(data, q_desired, qd_desired, qdd_desired)\n        data.ctrl[:nv] = tau\n\n        # Store\n        results['time'][i] = t\n        results['position'][i] = data.qpos[:nv].copy()\n        results['desired'][i] = q_desired.copy()\n        results['error'][i] = info['error'].copy()\n        results['torque'][i] = tau.copy()\n\n        mujoco.mj_step(model, data)\n\n    return results\n\n# Run trajectory tracking\nresults_traj = run_trajectory_tracking(model, data, ctc, duration=5.0)\n\n# Compute tracking error statistics\nrms_error = np.sqrt(np.mean(results_traj['error']**2, axis=0))\nmax_error = np.max(np.abs(results_traj['error']), axis=0)\n\nprint(f\"\\nTrajectory Tracking Performance:\")\nprint(f\"RMS error: {np.degrees(rms_error)} deg\")\nprint(f\"Max error: {np.degrees(max_error)} deg\")\n\n# Plot\nfig, axes = plt.subplots(2, 1, figsize=(12, 8), sharex=True)\n\nfor j in range(2):\n    axes[j].plot(results_traj['time'], np.degrees(results_traj['desired'][:, j]),\n                 'r--', linewidth=2, label='Desired')\n    axes[j].plot(results_traj['time'], np.degrees(results_traj['position'][:, j]),\n                 'b-', linewidth=1.5, label='Actual')\n    axes[j].set_ylabel(f'Joint {j} (deg)')\n    axes[j].legend()\n    axes[j].grid(True)\n\naxes[0].set_title('Trajectory Tracking with Computed Torque Control')\naxes[1].set_xlabel('Time (s)')\n\nplt.tight_layout()\nplt.savefig('trajectory_tracking.png', dpi=150)\nplt.show()\n"})}),"\n",(0,a.jsx)("checkpoint",{children:(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Expected"}),": Actual trajectory should closely follow desired, with RMS error < 2 degrees."]})}),"\n",(0,a.jsx)(s.h2,{id:"expected-outcomes",children:"Expected Outcomes"}),"\n",(0,a.jsx)(s.p,{children:"After completing this lab, you should have:"}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsxs)(s.li,{children:["\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Code artifacts"}),":"]}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"computed_torque.py"}),": CTC controller implementation"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"trajectory_generator.py"}),": Smooth trajectory generation"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(s.li,{children:["\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Visual outputs"}),":"]}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"ctc_vs_pid.png"}),": Comparison of CTC and PID performance"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.code,{children:"trajectory_tracking.png"}),": Trajectory following results"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(s.li,{children:["\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Understanding"}),":"]}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"How model-based control uses dynamics"}),"\n",(0,a.jsx)(s.li,{children:"Trade-offs between model-based and model-free control"}),"\n",(0,a.jsx)(s.li,{children:"Effect of feedforward terms on tracking"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"rubric",children:"Rubric"}),"\n",(0,a.jsxs)(s.table,{children:[(0,a.jsx)(s.thead,{children:(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.th,{children:"Criterion"}),(0,a.jsx)(s.th,{children:"Points"}),(0,a.jsx)(s.th,{children:"Description"})]})}),(0,a.jsxs)(s.tbody,{children:[(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:"Dynamics Extraction"}),(0,a.jsx)(s.td,{children:"15"}),(0,a.jsx)(s.td,{children:"Correctly obtains M and bias from MuJoCo"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:"CTC Implementation"}),(0,a.jsx)(s.td,{children:"30"}),(0,a.jsx)(s.td,{children:"Proper inverse dynamics computation"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:"Setpoint Control"}),(0,a.jsx)(s.td,{children:"15"}),(0,a.jsx)(s.td,{children:"Achieves target with small error"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:"Comparison"}),(0,a.jsx)(s.td,{children:"20"}),(0,a.jsx)(s.td,{children:"Fair comparison with PID control"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:"Trajectory Tracking"}),(0,a.jsx)(s.td,{children:"20"}),(0,a.jsx)(s.td,{children:"Demonstrates feedforward benefit"})]}),(0,a.jsxs)(s.tr,{children:[(0,a.jsx)(s.td,{children:(0,a.jsx)(s.strong,{children:"Total"})}),(0,a.jsx)(s.td,{children:(0,a.jsx)(s.strong,{children:"100"})}),(0,a.jsx)(s.td,{})]})]})]}),"\n",(0,a.jsx)(s.h2,{id:"common-errors",children:"Common Errors"}),"\n",(0,a.jsxs)("troubleshooting",{children:[(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Error"}),": Large torque spikes or instability\n",(0,a.jsx)(s.strong,{children:"Solution"}),": Check that dynamics matrices are computed after mj_forward(). Ensure consistent state."]}),(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Error"}),": Poor tracking despite correct implementation\n",(0,a.jsx)(s.strong,{children:"Solution"}),": Increase gains Kp/Kd. CTC doesn't remove the need for feedback."]}),(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Error"}),": CTC performs worse than PID\n",(0,a.jsx)(s.strong,{children:"Solution"}),": Verify model parameters match simulation. Model mismatch degrades CTC performance."]})]}),"\n",(0,a.jsx)(s.h2,{id:"extensions",children:"Extensions"}),"\n",(0,a.jsx)(s.p,{children:"For advanced students:"}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Model Uncertainty"}),": Add mass perturbations and observe robustness"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Adaptive Control"}),": Estimate parameters online to handle uncertainty"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Operational Space Control"}),": Implement task-space computed torque"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Force Control"}),": Combine with contact force regulation"]}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"related-content",children:"Related Content"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Theory"}),": Module 05 theory.md, Section 5.4 (Model-Based Control)"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Previous Lab"}),": Lab 05-01 (PID Control)"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Next Lab"}),": Lab 05-03 (Adaptive Control)"]}),"\n"]})]})}function m(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}}}]);