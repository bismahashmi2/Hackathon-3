"use strict";(globalThis.webpackChunkmy_book=globalThis.webpackChunkmy_book||[]).push([[7594],{5799(s,e,n){n.r(e),n.d(e,{assets:()=>o,contentTitle:()=>l,default:()=>m,frontMatter:()=>i,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"textbook/modules/manipulation/labs/lab-07-02","title":"Force Control and Compliance","description":"Objectives","source":"@site/docs/textbook/modules/07-manipulation/labs/lab-07-02.md","sourceDirName":"textbook/modules/07-manipulation/labs","slug":"/textbook/modules/manipulation/labs/lab-07-02","permalink":"/Hackathon-3/docs/textbook/modules/manipulation/labs/lab-07-02","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/textbook/modules/07-manipulation/labs/lab-07-02.md","tags":[],"version":"current","frontMatter":{"id":"lab-07-02","module_id":"07","title":"Force Control and Compliance","difficulty":"intermediate","tier":"simulation","duration_minutes":90},"sidebar":"tutorialSidebar","previous":{"title":"Basic Grasping in Simulation","permalink":"/Hackathon-3/docs/textbook/modules/manipulation/labs/lab-07-01"},"next":{"title":"Dexterous Multi-Finger Manipulation","permalink":"/Hackathon-3/docs/textbook/modules/manipulation/labs/lab-07-03"}}');var t=n(4848),r=n(8453);const i={id:"lab-07-02",module_id:"07",title:"Force Control and Compliance",difficulty:"intermediate",tier:"simulation",duration_minutes:90},l="Lab 07-02: Force Control and Compliance",o={},c=[{value:"Objectives",id:"objectives",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Materials",id:"materials",level:2},{value:"Background",id:"background",level:2},{value:"Why Force Control?",id:"why-force-control",level:3},{value:"Impedance Control",id:"impedance-control",level:3},{value:"Force Control",id:"force-control",level:3},{value:"Instructions",id:"instructions",level:2},{value:"Step 1: Set Up Force-Sensing Robot",id:"step-1-set-up-force-sensing-robot",level:3},{value:"Step 2: Implement Jacobian Computation",id:"step-2-implement-jacobian-computation",level:3},{value:"Step 3: Implement Impedance Controller",id:"step-3-implement-impedance-controller",level:3},{value:"Step 4: Test Compliant Motion",id:"step-4-test-compliant-motion",level:3},{value:"Step 5: Implement Force Controller",id:"step-5-implement-force-controller",level:3},{value:"Step 6: Surface Following Task",id:"step-6-surface-following-task",level:3},{value:"Expected Outcomes",id:"expected-outcomes",level:2},{value:"Rubric",id:"rubric",level:2},{value:"Common Errors",id:"common-errors",level:2},{value:"Extensions",id:"extensions",level:2},{value:"Related Content",id:"related-content",level:2}];function d(s){const e={annotation:"annotation",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",math:"math",mi:"mi",mo:"mo",mover:"mover",mrow:"mrow",msub:"msub",msup:"msup",ol:"ol",p:"p",pre:"pre",semantics:"semantics",span:"span",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...s.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"lab-07-02-force-control-and-compliance",children:"Lab 07-02: Force Control and Compliance"})}),"\n",(0,t.jsx)(e.h2,{id:"objectives",children:"Objectives"}),"\n",(0,t.jsx)(e.p,{children:"By the end of this lab, you will be able to:"}),"\n",(0,t.jsxs)(e.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(e.li,{className:"task-list-item",children:[(0,t.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Implement impedance control for compliant robot motion"]}),"\n",(0,t.jsxs)(e.li,{className:"task-list-item",children:[(0,t.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Design force feedback control loops"]}),"\n",(0,t.jsxs)(e.li,{className:"task-list-item",children:[(0,t.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Execute contact tasks with force regulation"]}),"\n",(0,t.jsxs)(e.li,{className:"task-list-item",children:[(0,t.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Tune compliance parameters for different tasks"]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Completed Lab 07-01 (Basic Grasping)"}),"\n",(0,t.jsx)(e.li,{children:"Understanding of dynamics and control (Module 05)"}),"\n",(0,t.jsx)(e.li,{children:"Familiarity with contact forces in MuJoCo"}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"materials",children:"Materials"}),"\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"Type"}),(0,t.jsx)(e.th,{children:"Name"}),(0,t.jsx)(e.th,{children:"Tier"}),(0,t.jsx)(e.th,{children:"Notes"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"software"}),(0,t.jsx)(e.td,{children:"MuJoCo 3.0+"}),(0,t.jsx)(e.td,{children:"required"}),(0,t.jsx)(e.td,{children:"Physics simulation with contacts"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"software"}),(0,t.jsx)(e.td,{children:"Python 3.10+"}),(0,t.jsx)(e.td,{children:"required"}),(0,t.jsx)(e.td,{children:"Programming environment"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"software"}),(0,t.jsx)(e.td,{children:"NumPy"}),(0,t.jsx)(e.td,{children:"required"}),(0,t.jsx)(e.td,{children:"Linear algebra"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"software"}),(0,t.jsx)(e.td,{children:"SciPy"}),(0,t.jsx)(e.td,{children:"required"}),(0,t.jsx)(e.td,{children:"Control design"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"simulation"}),(0,t.jsx)(e.td,{children:"arm-contact-table.xml"}),(0,t.jsx)(e.td,{children:"required"}),(0,t.jsx)(e.td,{children:"Robot arm with force sensing"})]})]})]}),"\n",(0,t.jsx)(e.h2,{id:"background",children:"Background"}),"\n",(0,t.jsx)(e.h3,{id:"why-force-control",children:"Why Force Control?"}),"\n",(0,t.jsx)(e.p,{children:"Position control alone is insufficient for:"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Assembly tasks (inserting pegs into holes)"}),"\n",(0,t.jsx)(e.li,{children:"Polishing/grinding (maintaining consistent pressure)"}),"\n",(0,t.jsx)(e.li,{children:"Human-robot interaction (safe collaboration)"}),"\n",(0,t.jsx)(e.li,{children:"Unknown environments (exploring with contact)"}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"impedance-control",children:"Impedance Control"}),"\n",(0,t.jsx)(e.p,{children:"Impedance control makes the robot behave like a mass-spring-damper system:"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsxs)(e.span,{className:"katex",children:[(0,t.jsx)(e.span,{className:"katex-mathml",children:(0,t.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(e.semantics,{children:[(0,t.jsxs)(e.mrow,{children:[(0,t.jsx)(e.mi,{children:"F"}),(0,t.jsx)(e.mo,{children:"="}),(0,t.jsxs)(e.msub,{children:[(0,t.jsx)(e.mi,{children:"M"}),(0,t.jsx)(e.mi,{children:"d"})]}),(0,t.jsx)(e.mo,{stretchy:"false",children:"("}),(0,t.jsxs)(e.msub,{children:[(0,t.jsxs)(e.mover,{accent:"true",children:[(0,t.jsx)(e.mi,{children:"x"}),(0,t.jsx)(e.mo,{children:"\xa8"})]}),(0,t.jsx)(e.mi,{children:"d"})]}),(0,t.jsx)(e.mo,{children:"\u2212"}),(0,t.jsxs)(e.mover,{accent:"true",children:[(0,t.jsx)(e.mi,{children:"x"}),(0,t.jsx)(e.mo,{children:"\xa8"})]}),(0,t.jsx)(e.mo,{stretchy:"false",children:")"}),(0,t.jsx)(e.mo,{children:"+"}),(0,t.jsxs)(e.msub,{children:[(0,t.jsx)(e.mi,{children:"B"}),(0,t.jsx)(e.mi,{children:"d"})]}),(0,t.jsx)(e.mo,{stretchy:"false",children:"("}),(0,t.jsxs)(e.msub,{children:[(0,t.jsxs)(e.mover,{accent:"true",children:[(0,t.jsx)(e.mi,{children:"x"}),(0,t.jsx)(e.mo,{children:"\u02d9"})]}),(0,t.jsx)(e.mi,{children:"d"})]}),(0,t.jsx)(e.mo,{children:"\u2212"}),(0,t.jsxs)(e.mover,{accent:"true",children:[(0,t.jsx)(e.mi,{children:"x"}),(0,t.jsx)(e.mo,{children:"\u02d9"})]}),(0,t.jsx)(e.mo,{stretchy:"false",children:")"}),(0,t.jsx)(e.mo,{children:"+"}),(0,t.jsxs)(e.msub,{children:[(0,t.jsx)(e.mi,{children:"K"}),(0,t.jsx)(e.mi,{children:"d"})]}),(0,t.jsx)(e.mo,{stretchy:"false",children:"("}),(0,t.jsxs)(e.msub,{children:[(0,t.jsx)(e.mi,{children:"x"}),(0,t.jsx)(e.mi,{children:"d"})]}),(0,t.jsx)(e.mo,{children:"\u2212"}),(0,t.jsx)(e.mi,{children:"x"}),(0,t.jsx)(e.mo,{stretchy:"false",children:")"})]}),(0,t.jsx)(e.annotation,{encoding:"application/x-tex",children:"F = M_d(\\ddot{x}_d - \\ddot{x}) + B_d(\\dot{x}_d - \\dot{x}) + K_d(x_d - x)"})]})})}),(0,t.jsxs)(e.span,{className:"katex-html","aria-hidden":"true",children:[(0,t.jsxs)(e.span,{className:"base",children:[(0,t.jsx)(e.span,{className:"strut",style:{height:"0.6833em"}}),(0,t.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"},children:"F"}),(0,t.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(e.span,{className:"mrel",children:"="}),(0,t.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,t.jsxs)(e.span,{className:"base",children:[(0,t.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,t.jsxs)(e.span,{className:"mord",children:[(0,t.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.10903em"},children:"M"}),(0,t.jsx)(e.span,{className:"msupsub",children:(0,t.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,t.jsxs)(e.span,{className:"vlist-r",children:[(0,t.jsx)(e.span,{className:"vlist",style:{height:"0.3361em"},children:(0,t.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.109em",marginRight:"0.05em"},children:[(0,t.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,t.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,t.jsx)(e.span,{className:"mord mathnormal mtight",children:"d"})})]})}),(0,t.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,t.jsx)(e.span,{className:"vlist-r",children:(0,t.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,t.jsx)(e.span,{})})})]})})]}),(0,t.jsx)(e.span,{className:"mopen",children:"("}),(0,t.jsxs)(e.span,{className:"mord",children:[(0,t.jsx)(e.span,{className:"mord accent",children:(0,t.jsx)(e.span,{className:"vlist-t",children:(0,t.jsx)(e.span,{className:"vlist-r",children:(0,t.jsxs)(e.span,{className:"vlist",style:{height:"0.6679em"},children:[(0,t.jsxs)(e.span,{style:{top:"-3em"},children:[(0,t.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,t.jsx)(e.span,{className:"mord mathnormal",children:"x"})]}),(0,t.jsxs)(e.span,{style:{top:"-3em"},children:[(0,t.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,t.jsx)(e.span,{className:"accent-body",style:{left:"-0.2222em"},children:(0,t.jsx)(e.span,{className:"mord",children:"\xa8"})})]})]})})})}),(0,t.jsx)(e.span,{className:"msupsub",children:(0,t.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,t.jsxs)(e.span,{className:"vlist-r",children:[(0,t.jsx)(e.span,{className:"vlist",style:{height:"0.3361em"},children:(0,t.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,t.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,t.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,t.jsx)(e.span,{className:"mord mathnormal mtight",children:"d"})})]})}),(0,t.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,t.jsx)(e.span,{className:"vlist-r",children:(0,t.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,t.jsx)(e.span,{})})})]})})]}),(0,t.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,t.jsx)(e.span,{className:"mbin",children:"\u2212"}),(0,t.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,t.jsxs)(e.span,{className:"base",children:[(0,t.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,t.jsx)(e.span,{className:"mord accent",children:(0,t.jsx)(e.span,{className:"vlist-t",children:(0,t.jsx)(e.span,{className:"vlist-r",children:(0,t.jsxs)(e.span,{className:"vlist",style:{height:"0.6679em"},children:[(0,t.jsxs)(e.span,{style:{top:"-3em"},children:[(0,t.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,t.jsx)(e.span,{className:"mord mathnormal",children:"x"})]}),(0,t.jsxs)(e.span,{style:{top:"-3em"},children:[(0,t.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,t.jsx)(e.span,{className:"accent-body",style:{left:"-0.2222em"},children:(0,t.jsx)(e.span,{className:"mord",children:"\xa8"})})]})]})})})}),(0,t.jsx)(e.span,{className:"mclose",children:")"}),(0,t.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,t.jsx)(e.span,{className:"mbin",children:"+"}),(0,t.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,t.jsxs)(e.span,{className:"base",children:[(0,t.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,t.jsxs)(e.span,{className:"mord",children:[(0,t.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.05017em"},children:"B"}),(0,t.jsx)(e.span,{className:"msupsub",children:(0,t.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,t.jsxs)(e.span,{className:"vlist-r",children:[(0,t.jsx)(e.span,{className:"vlist",style:{height:"0.3361em"},children:(0,t.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0502em",marginRight:"0.05em"},children:[(0,t.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,t.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,t.jsx)(e.span,{className:"mord mathnormal mtight",children:"d"})})]})}),(0,t.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,t.jsx)(e.span,{className:"vlist-r",children:(0,t.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,t.jsx)(e.span,{})})})]})})]}),(0,t.jsx)(e.span,{className:"mopen",children:"("}),(0,t.jsxs)(e.span,{className:"mord",children:[(0,t.jsx)(e.span,{className:"mord accent",children:(0,t.jsx)(e.span,{className:"vlist-t",children:(0,t.jsx)(e.span,{className:"vlist-r",children:(0,t.jsxs)(e.span,{className:"vlist",style:{height:"0.6679em"},children:[(0,t.jsxs)(e.span,{style:{top:"-3em"},children:[(0,t.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,t.jsx)(e.span,{className:"mord mathnormal",children:"x"})]}),(0,t.jsxs)(e.span,{style:{top:"-3em"},children:[(0,t.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,t.jsx)(e.span,{className:"accent-body",style:{left:"-0.1111em"},children:(0,t.jsx)(e.span,{className:"mord",children:"\u02d9"})})]})]})})})}),(0,t.jsx)(e.span,{className:"msupsub",children:(0,t.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,t.jsxs)(e.span,{className:"vlist-r",children:[(0,t.jsx)(e.span,{className:"vlist",style:{height:"0.3361em"},children:(0,t.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,t.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,t.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,t.jsx)(e.span,{className:"mord mathnormal mtight",children:"d"})})]})}),(0,t.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,t.jsx)(e.span,{className:"vlist-r",children:(0,t.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,t.jsx)(e.span,{})})})]})})]}),(0,t.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,t.jsx)(e.span,{className:"mbin",children:"\u2212"}),(0,t.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,t.jsxs)(e.span,{className:"base",children:[(0,t.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,t.jsx)(e.span,{className:"mord accent",children:(0,t.jsx)(e.span,{className:"vlist-t",children:(0,t.jsx)(e.span,{className:"vlist-r",children:(0,t.jsxs)(e.span,{className:"vlist",style:{height:"0.6679em"},children:[(0,t.jsxs)(e.span,{style:{top:"-3em"},children:[(0,t.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,t.jsx)(e.span,{className:"mord mathnormal",children:"x"})]}),(0,t.jsxs)(e.span,{style:{top:"-3em"},children:[(0,t.jsx)(e.span,{className:"pstrut",style:{height:"3em"}}),(0,t.jsx)(e.span,{className:"accent-body",style:{left:"-0.1111em"},children:(0,t.jsx)(e.span,{className:"mord",children:"\u02d9"})})]})]})})})}),(0,t.jsx)(e.span,{className:"mclose",children:")"}),(0,t.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,t.jsx)(e.span,{className:"mbin",children:"+"}),(0,t.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,t.jsxs)(e.span,{className:"base",children:[(0,t.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,t.jsxs)(e.span,{className:"mord",children:[(0,t.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"K"}),(0,t.jsx)(e.span,{className:"msupsub",children:(0,t.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,t.jsxs)(e.span,{className:"vlist-r",children:[(0,t.jsx)(e.span,{className:"vlist",style:{height:"0.3361em"},children:(0,t.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[(0,t.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,t.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,t.jsx)(e.span,{className:"mord mathnormal mtight",children:"d"})})]})}),(0,t.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,t.jsx)(e.span,{className:"vlist-r",children:(0,t.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,t.jsx)(e.span,{})})})]})})]}),(0,t.jsx)(e.span,{className:"mopen",children:"("}),(0,t.jsxs)(e.span,{className:"mord",children:[(0,t.jsx)(e.span,{className:"mord mathnormal",children:"x"}),(0,t.jsx)(e.span,{className:"msupsub",children:(0,t.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,t.jsxs)(e.span,{className:"vlist-r",children:[(0,t.jsx)(e.span,{className:"vlist",style:{height:"0.3361em"},children:(0,t.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,t.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,t.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,t.jsx)(e.span,{className:"mord mathnormal mtight",children:"d"})})]})}),(0,t.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,t.jsx)(e.span,{className:"vlist-r",children:(0,t.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,t.jsx)(e.span,{})})})]})})]}),(0,t.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,t.jsx)(e.span,{className:"mbin",children:"\u2212"}),(0,t.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,t.jsxs)(e.span,{className:"base",children:[(0,t.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,t.jsx)(e.span,{className:"mord mathnormal",children:"x"}),(0,t.jsx)(e.span,{className:"mclose",children:")"})]})]})]})}),"\n",(0,t.jsx)(e.p,{children:"Where:"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsxs)(e.span,{className:"katex",children:[(0,t.jsx)(e.span,{className:"katex-mathml",children:(0,t.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(e.semantics,{children:[(0,t.jsx)(e.mrow,{children:(0,t.jsxs)(e.msub,{children:[(0,t.jsx)(e.mi,{children:"M"}),(0,t.jsx)(e.mi,{children:"d"})]})}),(0,t.jsx)(e.annotation,{encoding:"application/x-tex",children:"M_d"})]})})}),(0,t.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,t.jsxs)(e.span,{className:"base",children:[(0,t.jsx)(e.span,{className:"strut",style:{height:"0.8333em",verticalAlign:"-0.15em"}}),(0,t.jsxs)(e.span,{className:"mord",children:[(0,t.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.10903em"},children:"M"}),(0,t.jsx)(e.span,{className:"msupsub",children:(0,t.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,t.jsxs)(e.span,{className:"vlist-r",children:[(0,t.jsx)(e.span,{className:"vlist",style:{height:"0.3361em"},children:(0,t.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.109em",marginRight:"0.05em"},children:[(0,t.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,t.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,t.jsx)(e.span,{className:"mord mathnormal mtight",children:"d"})})]})}),(0,t.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,t.jsx)(e.span,{className:"vlist-r",children:(0,t.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,t.jsx)(e.span,{})})})]})})]})]})})]}),": Desired inertia matrix"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsxs)(e.span,{className:"katex",children:[(0,t.jsx)(e.span,{className:"katex-mathml",children:(0,t.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(e.semantics,{children:[(0,t.jsx)(e.mrow,{children:(0,t.jsxs)(e.msub,{children:[(0,t.jsx)(e.mi,{children:"B"}),(0,t.jsx)(e.mi,{children:"d"})]})}),(0,t.jsx)(e.annotation,{encoding:"application/x-tex",children:"B_d"})]})})}),(0,t.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,t.jsxs)(e.span,{className:"base",children:[(0,t.jsx)(e.span,{className:"strut",style:{height:"0.8333em",verticalAlign:"-0.15em"}}),(0,t.jsxs)(e.span,{className:"mord",children:[(0,t.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.05017em"},children:"B"}),(0,t.jsx)(e.span,{className:"msupsub",children:(0,t.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,t.jsxs)(e.span,{className:"vlist-r",children:[(0,t.jsx)(e.span,{className:"vlist",style:{height:"0.3361em"},children:(0,t.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0502em",marginRight:"0.05em"},children:[(0,t.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,t.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,t.jsx)(e.span,{className:"mord mathnormal mtight",children:"d"})})]})}),(0,t.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,t.jsx)(e.span,{className:"vlist-r",children:(0,t.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,t.jsx)(e.span,{})})})]})})]})]})})]}),": Desired damping matrix"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsxs)(e.span,{className:"katex",children:[(0,t.jsx)(e.span,{className:"katex-mathml",children:(0,t.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(e.semantics,{children:[(0,t.jsx)(e.mrow,{children:(0,t.jsxs)(e.msub,{children:[(0,t.jsx)(e.mi,{children:"K"}),(0,t.jsx)(e.mi,{children:"d"})]})}),(0,t.jsx)(e.annotation,{encoding:"application/x-tex",children:"K_d"})]})})}),(0,t.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,t.jsxs)(e.span,{className:"base",children:[(0,t.jsx)(e.span,{className:"strut",style:{height:"0.8333em",verticalAlign:"-0.15em"}}),(0,t.jsxs)(e.span,{className:"mord",children:[(0,t.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"K"}),(0,t.jsx)(e.span,{className:"msupsub",children:(0,t.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,t.jsxs)(e.span,{className:"vlist-r",children:[(0,t.jsx)(e.span,{className:"vlist",style:{height:"0.3361em"},children:(0,t.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[(0,t.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,t.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,t.jsx)(e.span,{className:"mord mathnormal mtight",children:"d"})})]})}),(0,t.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,t.jsx)(e.span,{className:"vlist-r",children:(0,t.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,t.jsx)(e.span,{})})})]})})]})]})})]}),": Desired stiffness matrix"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsxs)(e.span,{className:"katex",children:[(0,t.jsx)(e.span,{className:"katex-mathml",children:(0,t.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(e.semantics,{children:[(0,t.jsx)(e.mrow,{children:(0,t.jsxs)(e.msub,{children:[(0,t.jsx)(e.mi,{children:"x"}),(0,t.jsx)(e.mi,{children:"d"})]})}),(0,t.jsx)(e.annotation,{encoding:"application/x-tex",children:"x_d"})]})})}),(0,t.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,t.jsxs)(e.span,{className:"base",children:[(0,t.jsx)(e.span,{className:"strut",style:{height:"0.5806em",verticalAlign:"-0.15em"}}),(0,t.jsxs)(e.span,{className:"mord",children:[(0,t.jsx)(e.span,{className:"mord mathnormal",children:"x"}),(0,t.jsx)(e.span,{className:"msupsub",children:(0,t.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,t.jsxs)(e.span,{className:"vlist-r",children:[(0,t.jsx)(e.span,{className:"vlist",style:{height:"0.3361em"},children:(0,t.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,t.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,t.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,t.jsx)(e.span,{className:"mord mathnormal mtight",children:"d"})})]})}),(0,t.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,t.jsx)(e.span,{className:"vlist-r",children:(0,t.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,t.jsx)(e.span,{})})})]})})]})]})})]}),": Desired position trajectory"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"force-control",children:"Force Control"}),"\n",(0,t.jsx)(e.p,{children:"Direct force control regulates contact forces:"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsxs)(e.span,{className:"katex",children:[(0,t.jsx)(e.span,{className:"katex-mathml",children:(0,t.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(e.semantics,{children:[(0,t.jsxs)(e.mrow,{children:[(0,t.jsx)(e.mi,{children:"\u03c4"}),(0,t.jsx)(e.mo,{children:"="}),(0,t.jsxs)(e.msup,{children:[(0,t.jsx)(e.mi,{children:"J"}),(0,t.jsx)(e.mi,{children:"T"})]}),(0,t.jsx)(e.mo,{stretchy:"false",children:"("}),(0,t.jsx)(e.mi,{children:"q"}),(0,t.jsx)(e.mo,{stretchy:"false",children:")"}),(0,t.jsx)(e.mo,{stretchy:"false",children:"("}),(0,t.jsxs)(e.msub,{children:[(0,t.jsx)(e.mi,{children:"F"}),(0,t.jsx)(e.mi,{children:"d"})]}),(0,t.jsx)(e.mo,{children:"+"}),(0,t.jsxs)(e.msub,{children:[(0,t.jsx)(e.mi,{children:"K"}),(0,t.jsx)(e.mi,{children:"f"})]}),(0,t.jsx)(e.mo,{stretchy:"false",children:"("}),(0,t.jsxs)(e.msub,{children:[(0,t.jsx)(e.mi,{children:"F"}),(0,t.jsx)(e.mi,{children:"d"})]}),(0,t.jsx)(e.mo,{children:"\u2212"}),(0,t.jsxs)(e.msub,{children:[(0,t.jsx)(e.mi,{children:"F"}),(0,t.jsxs)(e.mrow,{children:[(0,t.jsx)(e.mi,{children:"m"}),(0,t.jsx)(e.mi,{children:"e"}),(0,t.jsx)(e.mi,{children:"a"}),(0,t.jsx)(e.mi,{children:"s"}),(0,t.jsx)(e.mi,{children:"u"}),(0,t.jsx)(e.mi,{children:"r"}),(0,t.jsx)(e.mi,{children:"e"}),(0,t.jsx)(e.mi,{children:"d"})]})]}),(0,t.jsx)(e.mo,{stretchy:"false",children:")"}),(0,t.jsx)(e.mo,{stretchy:"false",children:")"})]}),(0,t.jsx)(e.annotation,{encoding:"application/x-tex",children:"\\tau = J^T(q)(F_d + K_f(F_d - F_{measured}))"})]})})}),(0,t.jsxs)(e.span,{className:"katex-html","aria-hidden":"true",children:[(0,t.jsxs)(e.span,{className:"base",children:[(0,t.jsx)(e.span,{className:"strut",style:{height:"0.4306em"}}),(0,t.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.1132em"},children:"\u03c4"}),(0,t.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(e.span,{className:"mrel",children:"="}),(0,t.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,t.jsxs)(e.span,{className:"base",children:[(0,t.jsx)(e.span,{className:"strut",style:{height:"1.0913em",verticalAlign:"-0.25em"}}),(0,t.jsxs)(e.span,{className:"mord",children:[(0,t.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.09618em"},children:"J"}),(0,t.jsx)(e.span,{className:"msupsub",children:(0,t.jsx)(e.span,{className:"vlist-t",children:(0,t.jsx)(e.span,{className:"vlist-r",children:(0,t.jsx)(e.span,{className:"vlist",style:{height:"0.8413em"},children:(0,t.jsxs)(e.span,{style:{top:"-3.063em",marginRight:"0.05em"},children:[(0,t.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,t.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,t.jsx)(e.span,{className:"mord mathnormal mtight",style:{marginRight:"0.13889em"},children:"T"})})]})})})})})]}),(0,t.jsx)(e.span,{className:"mopen",children:"("}),(0,t.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"q"}),(0,t.jsx)(e.span,{className:"mclose",children:")"}),(0,t.jsx)(e.span,{className:"mopen",children:"("}),(0,t.jsxs)(e.span,{className:"mord",children:[(0,t.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"},children:"F"}),(0,t.jsx)(e.span,{className:"msupsub",children:(0,t.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,t.jsxs)(e.span,{className:"vlist-r",children:[(0,t.jsx)(e.span,{className:"vlist",style:{height:"0.3361em"},children:(0,t.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.1389em",marginRight:"0.05em"},children:[(0,t.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,t.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,t.jsx)(e.span,{className:"mord mathnormal mtight",children:"d"})})]})}),(0,t.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,t.jsx)(e.span,{className:"vlist-r",children:(0,t.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,t.jsx)(e.span,{})})})]})})]}),(0,t.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,t.jsx)(e.span,{className:"mbin",children:"+"}),(0,t.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,t.jsxs)(e.span,{className:"base",children:[(0,t.jsx)(e.span,{className:"strut",style:{height:"1.0361em",verticalAlign:"-0.2861em"}}),(0,t.jsxs)(e.span,{className:"mord",children:[(0,t.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"K"}),(0,t.jsx)(e.span,{className:"msupsub",children:(0,t.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,t.jsxs)(e.span,{className:"vlist-r",children:[(0,t.jsx)(e.span,{className:"vlist",style:{height:"0.3361em"},children:(0,t.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[(0,t.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,t.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,t.jsx)(e.span,{className:"mord mathnormal mtight",style:{marginRight:"0.10764em"},children:"f"})})]})}),(0,t.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,t.jsx)(e.span,{className:"vlist-r",children:(0,t.jsx)(e.span,{className:"vlist",style:{height:"0.2861em"},children:(0,t.jsx)(e.span,{})})})]})})]}),(0,t.jsx)(e.span,{className:"mopen",children:"("}),(0,t.jsxs)(e.span,{className:"mord",children:[(0,t.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"},children:"F"}),(0,t.jsx)(e.span,{className:"msupsub",children:(0,t.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,t.jsxs)(e.span,{className:"vlist-r",children:[(0,t.jsx)(e.span,{className:"vlist",style:{height:"0.3361em"},children:(0,t.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.1389em",marginRight:"0.05em"},children:[(0,t.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,t.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,t.jsx)(e.span,{className:"mord mathnormal mtight",children:"d"})})]})}),(0,t.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,t.jsx)(e.span,{className:"vlist-r",children:(0,t.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,t.jsx)(e.span,{})})})]})})]}),(0,t.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,t.jsx)(e.span,{className:"mbin",children:"\u2212"}),(0,t.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,t.jsxs)(e.span,{className:"base",children:[(0,t.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,t.jsxs)(e.span,{className:"mord",children:[(0,t.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"},children:"F"}),(0,t.jsx)(e.span,{className:"msupsub",children:(0,t.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,t.jsxs)(e.span,{className:"vlist-r",children:[(0,t.jsx)(e.span,{className:"vlist",style:{height:"0.3361em"},children:(0,t.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"-0.1389em",marginRight:"0.05em"},children:[(0,t.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,t.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,t.jsxs)(e.span,{className:"mord mtight",children:[(0,t.jsx)(e.span,{className:"mord mathnormal mtight",children:"m"}),(0,t.jsx)(e.span,{className:"mord mathnormal mtight",children:"e"}),(0,t.jsx)(e.span,{className:"mord mathnormal mtight",children:"a"}),(0,t.jsx)(e.span,{className:"mord mathnormal mtight",children:"s"}),(0,t.jsx)(e.span,{className:"mord mathnormal mtight",children:"u"}),(0,t.jsx)(e.span,{className:"mord mathnormal mtight",children:"re"}),(0,t.jsx)(e.span,{className:"mord mathnormal mtight",children:"d"})]})})]})}),(0,t.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,t.jsx)(e.span,{className:"vlist-r",children:(0,t.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,t.jsx)(e.span,{})})})]})})]}),(0,t.jsx)(e.span,{className:"mclose",children:"))"})]})]})]})}),"\n",(0,t.jsx)(e.h2,{id:"instructions",children:"Instructions"}),"\n",(0,t.jsx)(e.h3,{id:"step-1-set-up-force-sensing-robot",children:"Step 1: Set Up Force-Sensing Robot"}),"\n",(0,t.jsx)(e.p,{children:"Load a robot with force/torque sensing capability:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:'import mujoco\nimport numpy as np\nimport matplotlib.pyplot as plt\n\n# Load model with force sensing\nmodel = mujoco.MjModel.from_xml_path(\n    "textbook/assets/robot-models/mujoco/arm-contact-table.xml"\n)\ndata = mujoco.MjData(model)\n\n# Find the force sensor\nsensor_id = mujoco.mj_name2id(model, mujoco.mjtObj.mjOBJ_SENSOR, "ee_force")\nprint(f"Force sensor ID: {sensor_id}")\n\n# Get sensor data dimensions\nsensor_adr = model.sensor_adr[sensor_id]\nsensor_dim = model.sensor_dim[sensor_id]\nprint(f"Sensor address: {sensor_adr}, dimension: {sensor_dim}")\n\n# Initialize simulation\nmujoco.mj_resetData(model, data)\nmujoco.mj_forward(model, data)\n\ndef get_ee_force():\n    """Read end-effector force from sensor."""\n    return data.sensordata[sensor_adr:sensor_adr + sensor_dim].copy()\n\n# Test force reading\nprint(f"Initial EE force: {get_ee_force()}")\n'})}),"\n",(0,t.jsx)("checkpoint",{children:(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Expected"}),": Force sensor identified and returning 3D or 6D force/torque readings."]})}),"\n",(0,t.jsx)(e.h3,{id:"step-2-implement-jacobian-computation",children:"Step 2: Implement Jacobian Computation"}),"\n",(0,t.jsx)(e.p,{children:"Compute the geometric Jacobian for force transformation:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:'def compute_jacobian(model, data, body_id):\n    """\n    Compute the geometric Jacobian for a body.\n\n    Args:\n        model: MuJoCo model\n        data: MuJoCo data\n        body_id: Body ID for Jacobian computation\n\n    Returns:\n        J: 6 x nv Jacobian matrix (linear + angular)\n    """\n    jacp = np.zeros((3, model.nv))  # Position Jacobian\n    jacr = np.zeros((3, model.nv))  # Rotation Jacobian\n\n    mujoco.mj_jacBody(model, data, jacp, jacr, body_id)\n\n    # Stack to form full Jacobian\n    J = np.vstack([jacp, jacr])\n\n    return J\n\n# Get end-effector body ID\nee_body_id = mujoco.mj_name2id(model, mujoco.mjtObj.mjOBJ_BODY, "end_effector")\n\n# Compute Jacobian\nJ = compute_jacobian(model, data, ee_body_id)\nprint(f"Jacobian shape: {J.shape}")\nprint(f"Jacobian (position rows):\\n{J[:3, :]}")\n'})}),"\n",(0,t.jsx)("checkpoint",{children:(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Expected"}),": Jacobian matrix computed with shape (6, nv)."]})}),"\n",(0,t.jsx)(e.h3,{id:"step-3-implement-impedance-controller",children:"Step 3: Implement Impedance Controller"}),"\n",(0,t.jsx)(e.p,{children:"Create an impedance controller for compliant motion:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:'class ImpedanceController:\n    """Cartesian impedance controller for compliant motion."""\n\n    def __init__(self, model, data, ee_body_id):\n        self.model = model\n        self.data = data\n        self.ee_body_id = ee_body_id\n\n        # Impedance parameters (diagonal for simplicity)\n        # Stiffness: N/m for position, Nm/rad for orientation\n        self.K = np.diag([500, 500, 500, 50, 50, 50])\n\n        # Damping: Ns/m for position, Nms/rad for orientation\n        self.D = np.diag([50, 50, 50, 5, 5, 5])\n\n        # Desired inertia (optional, often set to identity)\n        self.M = np.eye(6)\n\n        # Nullspace stiffness for joint position regularization\n        self.K_null = 10 * np.eye(model.nv)\n        self.q_null = np.zeros(model.nv)  # Nominal joint positions\n\n    def set_impedance(self, K_pos, K_ori, D_pos, D_ori):\n        """Set impedance parameters."""\n        self.K = np.diag([K_pos, K_pos, K_pos, K_ori, K_ori, K_ori])\n        self.D = np.diag([D_pos, D_pos, D_pos, D_ori, D_ori, D_ori])\n\n    def compute_pose_error(self, x_des, quat_des):\n        """\n        Compute pose error between current and desired.\n\n        Returns:\n            error: 6D pose error [position_error; orientation_error]\n        """\n        # Current pose\n        x_cur = self.data.xpos[self.ee_body_id].copy()\n        quat_cur = self.data.xquat[self.ee_body_id].copy()\n\n        # Position error\n        pos_error = x_des - x_cur\n\n        # Orientation error (using quaternion difference)\n        # quat_error = quat_des * quat_cur^(-1)\n        quat_cur_inv = quat_cur.copy()\n        quat_cur_inv[1:] *= -1  # Conjugate for unit quaternion\n\n        # Quaternion multiplication\n        quat_error = np.array([\n            quat_des[0]*quat_cur_inv[0] - np.dot(quat_des[1:], quat_cur_inv[1:]),\n            quat_des[0]*quat_cur_inv[1] + quat_cur_inv[0]*quat_des[1] +\n                np.cross(quat_des[1:], quat_cur_inv[1:])[0],\n            quat_des[0]*quat_cur_inv[2] + quat_cur_inv[0]*quat_des[2] +\n                np.cross(quat_des[1:], quat_cur_inv[1:])[1],\n            quat_des[0]*quat_cur_inv[3] + quat_cur_inv[0]*quat_des[3] +\n                np.cross(quat_des[1:], quat_cur_inv[1:])[2],\n        ])\n\n        # Convert to axis-angle error (small angle approximation)\n        ori_error = 2 * quat_error[1:] * np.sign(quat_error[0])\n\n        return np.concatenate([pos_error, ori_error])\n\n    def compute_velocity_error(self, xdot_des):\n        """Compute Cartesian velocity error."""\n        J = compute_jacobian(self.model, self.data, self.ee_body_id)\n        xdot_cur = J @ self.data.qvel\n        return xdot_des - xdot_cur\n\n    def compute_torques(self, x_des, quat_des, xdot_des=None, F_ext=None):\n        """\n        Compute joint torques for impedance control.\n\n        Args:\n            x_des: Desired position [3]\n            quat_des: Desired orientation quaternion [4]\n            xdot_des: Desired velocity [6] (optional)\n            F_ext: External force compensation [6] (optional)\n\n        Returns:\n            tau: Joint torques [nv]\n        """\n        if xdot_des is None:\n            xdot_des = np.zeros(6)\n        if F_ext is None:\n            F_ext = np.zeros(6)\n\n        # Compute errors\n        pose_error = self.compute_pose_error(x_des, quat_des)\n        vel_error = self.compute_velocity_error(xdot_des)\n\n        # Compute Cartesian force from impedance law\n        F_imp = self.K @ pose_error + self.D @ vel_error\n\n        # Add external force compensation\n        F_total = F_imp + F_ext\n\n        # Get Jacobian\n        J = compute_jacobian(self.model, self.data, self.ee_body_id)\n\n        # Map to joint torques\n        tau = J.T @ F_total\n\n        # Add nullspace component for joint regularization\n        N = np.eye(self.model.nv) - np.linalg.pinv(J) @ J\n        tau_null = N @ (self.K_null @ (self.q_null - self.data.qpos[:self.model.nv]))\n\n        # Add gravity compensation\n        gravity_comp = self.data.qfrc_bias.copy()\n\n        return tau + tau_null + gravity_comp\n\n# Create controller\ncontroller = ImpedanceController(model, data, ee_body_id)\n\n# Test: compute torques for current pose (should be near zero)\nx_des = data.xpos[ee_body_id].copy()\nquat_des = data.xquat[ee_body_id].copy()\ntau = controller.compute_torques(x_des, quat_des)\nprint(f"Torques for holding position: {tau}")\n'})}),"\n",(0,t.jsx)("checkpoint",{children:(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Expected"}),": ImpedanceController computes torques that maintain position when desired equals current."]})}),"\n",(0,t.jsx)(e.h3,{id:"step-4-test-compliant-motion",children:"Step 4: Test Compliant Motion"}),"\n",(0,t.jsx)(e.p,{children:"Execute a motion task with compliance:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:"def run_impedance_control(controller, x_trajectory, quat_fixed,\n                          duration_per_point=1.0, dt=0.002):\n    \"\"\"\n    Execute trajectory with impedance control.\n\n    Args:\n        controller: ImpedanceController instance\n        x_trajectory: List of target positions\n        quat_fixed: Fixed orientation quaternion\n        duration_per_point: Time to spend at each waypoint\n        dt: Simulation timestep\n\n    Returns:\n        history: Dictionary of recorded data\n    \"\"\"\n    history = {\n        'time': [],\n        'x': [],\n        'x_des': [],\n        'force': [],\n        'torque': []\n    }\n\n    t = 0\n    waypoint_idx = 0\n\n    steps_per_waypoint = int(duration_per_point / dt)\n\n```python\n```python\n    while waypoint_idx < len(x_trajectory):\n"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"        x_des = x_trajectory[waypoint_idx]\n\n        for step in range(steps_per_waypoint):\n            # Compute control\n            tau = controller.compute_torques(x_des, quat_fixed)\n\n            # Apply torques (clamp for safety)\n            tau_max = 100\n            tau = np.clip(tau, -tau_max, tau_max)\n            controller.data.ctrl[:len(tau)] = tau\n\n            # Step simulation\n            mujoco.mj_step(controller.model, controller.data)\n\n            # Record data\n            t += dt\n            history['time'].append(t)\n            history['x'].append(controller.data.xpos[controller.ee_body_id].copy())\n            history['x_des'].append(x_des.copy())\n            history['force'].append(get_ee_force())\n            history['torque'].append(tau.copy())\n\n        waypoint_idx += 1\n\n    return history\n\n# Define a simple trajectory\nx_start = data.xpos[ee_body_id].copy()\nx_trajectory = [\n    x_start,\n    x_start + np.array([0.1, 0, 0]),    # Move +X\n    x_start + np.array([0.1, 0, -0.1]), # Move down (contact)\n    x_start + np.array([0.1, 0, -0.05]),# Back up slightly\n]\nquat_fixed = data.xquat[ee_body_id].copy()\n\n# Reset simulation\nmujoco.mj_resetData(model, data)\nmujoco.mj_forward(model, data)\n\n# Run with low stiffness (compliant)\ncontroller.set_impedance(K_pos=200, K_ori=20, D_pos=40, D_ori=4)\nhistory_compliant = run_impedance_control(controller, x_trajectory, quat_fixed)\n\n# Reset and run with high stiffness (stiff)\nmujoco.mj_resetData(model, data)\nmujoco.mj_forward(model, data)\ncontroller.set_impedance(K_pos=2000, K_ori=200, D_pos=100, D_ori=10)\nhistory_stiff = run_impedance_control(controller, x_trajectory, quat_fixed)\n\nprint(f\"Compliant: max force = {np.max(np.abs(history_compliant['force'])):.2f} N\")\nprint(f\"Stiff: max force = {np.max(np.abs(history_stiff['force'])):.2f} N\")\n"})}),"\n",(0,t.jsx)("checkpoint",{children:(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Expected"}),": Compliant motion shows lower contact forces than stiff motion."]})}),"\n",(0,t.jsx)(e.h3,{id:"step-5-implement-force-controller",children:"Step 5: Implement Force Controller"}),"\n",(0,t.jsx)(e.p,{children:"Create a direct force controller for contact tasks:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:'class ForceController:\n    """Hybrid position/force controller."""\n\n    def __init__(self, model, data, ee_body_id, sensor_id):\n        self.model = model\n        self.data = data\n        self.ee_body_id = ee_body_id\n        self.sensor_id = sensor_id\n\n        # Selection matrix: 1 for force control, 0 for position control\n        # Default: force control in Z, position in X, Y, Rx, Ry, Rz\n        self.S_f = np.diag([0, 0, 1, 0, 0, 0])\n        self.S_p = np.eye(6) - self.S_f\n\n        # Position controller gains\n        self.K_p = np.diag([500, 500, 500, 50, 50, 50])\n        self.D_p = np.diag([50, 50, 50, 5, 5, 5])\n\n        # Force controller gains\n        self.K_f = 0.001  # Force feedback gain\n        self.K_i = 0.0001  # Integral gain\n\n        # Force integral term\n        self.force_integral = np.zeros(6)\n\n    def get_measured_force(self):\n        """Get force measurement from sensor."""\n        sensor_adr = self.model.sensor_adr[self.sensor_id]\n        sensor_dim = self.model.sensor_dim[self.sensor_id]\n\n        force = np.zeros(6)\n        force[:sensor_dim] = self.data.sensordata[sensor_adr:sensor_adr + sensor_dim]\n        return force\n\n    def compute_torques(self, x_des, quat_des, F_des, dt=0.002):\n        """\n        Compute torques for hybrid position/force control.\n\n        Args:\n            x_des: Desired position [3]\n            quat_des: Desired orientation quaternion [4]\n            F_des: Desired force [6] (only force-controlled axes matter)\n            dt: Control timestep for integral\n\n        Returns:\n            tau: Joint torques\n        """\n        # Get Jacobian\n        J = compute_jacobian(self.model, self.data, self.ee_body_id)\n\n        # Position control component\n        # Compute pose error\n        x_cur = self.data.xpos[self.ee_body_id].copy()\n        pos_error = x_des - x_cur\n\n        # Simple velocity from finite difference (or use qvel)\n        xdot = J @ self.data.qvel\n\n        # Position control force\n        pose_error_6d = np.zeros(6)\n        pose_error_6d[:3] = pos_error\n        F_pos = self.K_p @ pose_error_6d - self.D_p @ xdot\n\n        # Force control component\n        F_measured = self.get_measured_force()\n        F_error = F_des - F_measured\n\n        # PI force control\n        self.force_integral += F_error * dt\n        F_force = self.K_f * F_error + self.K_i * self.force_integral\n\n        # Combine using selection matrices\n        F_total = self.S_p @ F_pos + self.S_f @ (F_des + F_force)\n\n        # Map to joint torques\n        tau = J.T @ F_total\n\n        # Add gravity compensation\n        tau += self.data.qfrc_bias.copy()\n\n        return tau\n\n    def set_force_axis(self, axis=\'z\'):\n        """Set which axis is force-controlled."""\n        self.S_f = np.zeros((6, 6))\n```python\n```python\n        if axis == \'x\':\n'})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"            self.S_f[0, 0] = 1\n        elif axis == 'y':\n            self.S_f[1, 1] = 1\n        elif axis == 'z':\n            self.S_f[2, 2] = 1\n        self.S_p = np.eye(6) - self.S_f\n\n        # Reset integral\n        self.force_integral = np.zeros(6)\n\n# Create force controller\nforce_ctrl = ForceController(model, data, ee_body_id, sensor_id)\n\n# Test force regulation against surface\ndef run_force_control(controller, x_des, quat_des, F_des, duration=3.0, dt=0.002):\n    \"\"\"Run force control and record data.\"\"\"\n    history = {\n        'time': [],\n        'z': [],\n        'force_z': [],\n        'force_des': []\n    }\n\n    steps = int(duration / dt)\n\n    for i in range(steps):\n        # Compute and apply control\n        tau = controller.compute_torques(x_des, quat_des, F_des, dt)\n        tau = np.clip(tau, -100, 100)\n        controller.data.ctrl[:len(tau)] = tau\n\n        # Step simulation\n        mujoco.mj_step(controller.model, controller.data)\n\n        # Record\n        history['time'].append(i * dt)\n        history['z'].append(controller.data.xpos[controller.ee_body_id][2])\n        history['force_z'].append(controller.get_measured_force()[2])\n        history['force_des'].append(F_des[2])\n\n    return history\n\n# Set up: move to contact position first\nmujoco.mj_resetData(model, data)\nmujoco.mj_forward(model, data)\n\n# Target position and force\nx_des = data.xpos[ee_body_id].copy()\nx_des[2] -= 0.1  # Move down toward table\nquat_des = data.xquat[ee_body_id].copy()\nF_des = np.array([0, 0, -10, 0, 0, 0])  # 10N pushing down\n\n# Run force control\nforce_ctrl.set_force_axis('z')\nhistory = run_force_control(force_ctrl, x_des, quat_des, F_des)\n\n# Analyze results\nfinal_force = np.mean(history['force_z'][-100:])\nprint(f\"Desired force: {F_des[2]} N\")\nprint(f\"Achieved force: {final_force:.2f} N\")\nprint(f\"Steady-state error: {abs(F_des[2] - final_force):.2f} N\")\n"})}),"\n",(0,t.jsx)("checkpoint",{children:(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Expected"}),": Force controller regulates contact force to desired value within reasonable error."]})}),"\n",(0,t.jsx)(e.h3,{id:"step-6-surface-following-task",children:"Step 6: Surface Following Task"}),"\n",(0,t.jsx)(e.p,{children:"Combine position and force control for surface following:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:"def surface_following(controller, x_path, quat_des, F_normal, dt=0.002):\n    \"\"\"\n    Follow a path while maintaining contact force.\n\n    Args:\n        controller: ForceController\n        x_path: List of 2D positions (X, Y) to follow\n        quat_des: Fixed orientation\n        F_normal: Desired normal force (positive = pushing)\n        dt: Control timestep\n\n    Returns:\n        history: Recorded trajectory data\n    \"\"\"\n    history = {\n        'time': [],\n        'x': [],\n        'y': [],\n        'z': [],\n        'force_z': []\n    }\n\n    t = 0\n    F_des = np.array([0, 0, -F_normal, 0, 0, 0])\n\n    for xy in x_path:\n        # Target: follow XY from path, Z from force control\n        x_des = np.array([xy[0], xy[1], 0.0])  # Z will be adjusted by force control\n\n        # Run for some steps at each waypoint\n        for _ in range(50):  # 100ms per point\n            tau = controller.compute_torques(x_des, quat_des, F_des, dt)\n            tau = np.clip(tau, -100, 100)\n            controller.data.ctrl[:len(tau)] = tau\n\n            mujoco.mj_step(controller.model, controller.data)\n\n            t += dt\n            ee_pos = controller.data.xpos[controller.ee_body_id]\n            history['time'].append(t)\n            history['x'].append(ee_pos[0])\n            history['y'].append(ee_pos[1])\n            history['z'].append(ee_pos[2])\n            history['force_z'].append(controller.get_measured_force()[2])\n\n    return history\n\n# Create a circular path\ntheta = np.linspace(0, 2*np.pi, 50)\nradius = 0.05\ncenter = data.xpos[ee_body_id][:2]\nx_path = [(center[0] + radius * np.cos(t),\n           center[1] + radius * np.sin(t)) for t in theta]\n\n# Reset and run\nmujoco.mj_resetData(model, data)\nmujoco.mj_forward(model, data)\n\n# First establish contact\nforce_ctrl = ForceController(model, data, ee_body_id, sensor_id)\nforce_ctrl.set_force_axis('z')\n\n# Run surface following\nhistory_sf = surface_following(force_ctrl, x_path, quat_des, F_normal=5.0)\n\n# Check force consistency\nforce_std = np.std(history_sf['force_z'])\nforce_mean = np.mean(history_sf['force_z'])\nprint(f\"Surface following force: {force_mean:.2f} \xb1 {force_std:.2f} N\")\n"})}),"\n",(0,t.jsx)("checkpoint",{children:(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Expected"}),": End-effector follows XY path while maintaining consistent contact force."]})}),"\n",(0,t.jsx)(e.h2,{id:"expected-outcomes",children:"Expected Outcomes"}),"\n",(0,t.jsx)(e.p,{children:"After completing this lab, you should have:"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Code artifacts"}),":"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"impedance_controller.py"}),": Cartesian impedance control"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"force_controller.py"}),": Hybrid position/force control"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"surface_following.py"}),": Combined task demonstration"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Understanding"}),":"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Relationship between stiffness, damping, and compliance"}),"\n",(0,t.jsx)(e.li,{children:"When to use impedance vs. direct force control"}),"\n",(0,t.jsx)(e.li,{children:"Challenges of force control (sensor noise, stability)"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Experimental results"}),":"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Comparison of contact forces with different impedances"}),"\n",(0,t.jsx)(e.li,{children:"Force tracking accuracy measurements"}),"\n",(0,t.jsx)(e.li,{children:"Surface following performance"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"rubric",children:"Rubric"}),"\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"Criterion"}),(0,t.jsx)(e.th,{children:"Points"}),(0,t.jsx)(e.th,{children:"Description"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Jacobian Computation"}),(0,t.jsx)(e.td,{children:"15"}),(0,t.jsx)(e.td,{children:"Correct geometric Jacobian"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Impedance Controller"}),(0,t.jsx)(e.td,{children:"25"}),(0,t.jsx)(e.td,{children:"Working compliance with tunable parameters"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Force Controller"}),(0,t.jsx)(e.td,{children:"25"}),(0,t.jsx)(e.td,{children:"PI force regulation with hybrid control"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Surface Following"}),(0,t.jsx)(e.td,{children:"20"}),(0,t.jsx)(e.td,{children:"Maintains contact while following path"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Analysis"}),(0,t.jsx)(e.td,{children:"15"}),(0,t.jsx)(e.td,{children:"Comparison of control modes, parameter tuning"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:(0,t.jsx)(e.strong,{children:"Total"})}),(0,t.jsx)(e.td,{children:(0,t.jsx)(e.strong,{children:"100"})}),(0,t.jsx)(e.td,{})]})]})]}),"\n",(0,t.jsx)(e.h2,{id:"common-errors",children:"Common Errors"}),"\n",(0,t.jsxs)("troubleshooting",{children:[(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Error"}),": Unstable oscillations in force control\n",(0,t.jsx)(e.strong,{children:"Solution"}),": Reduce force gain K_f, add filtering to force measurements."]}),(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Error"}),": Force doesn't converge to desired value\n",(0,t.jsx)(e.strong,{children:"Solution"}),": Check sensor direction conventions, increase integral gain carefully."]}),(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Error"}),": Robot drifts during surface following\n",(0,t.jsx)(e.strong,{children:"Solution"}),": Increase position gains for X-Y axes, ensure force axis selection is correct."]})]}),"\n",(0,t.jsx)(e.h2,{id:"extensions",children:"Extensions"}),"\n",(0,t.jsx)(e.p,{children:"For advanced students:"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Admittance Control"}),": Implement the dual of impedance control"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Variable Impedance"}),": Adapt stiffness based on task phase"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Estimated Force"}),": Use motor current for force estimation without sensors"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Multi-Point Contact"}),": Handle simultaneous contacts at multiple points"]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"related-content",children:"Related Content"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Theory"}),": Module 07 theory.md, Section 7.3 (Force Control)"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Previous Lab"}),": Lab 07-01 (Basic Grasping)"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Next Lab"}),": Lab 07-03 (Dexterous Manipulation)"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Application"}),": Industrial polishing, assembly insertion, human collaboration"]}),"\n"]})]})}function m(s={}){const{wrapper:e}={...(0,r.R)(),...s.components};return e?(0,t.jsx)(e,{...s,children:(0,t.jsx)(d,{...s})}):d(s)}},8453(s,e,n){n.d(e,{R:()=>i,x:()=>l});var a=n(6540);const t={},r=a.createContext(t);function i(s){const e=a.useContext(r);return a.useMemo(function(){return"function"==typeof s?s(e):{...e,...s}},[e,s])}function l(s){let e;return e=s.disableParentContext?"function"==typeof s.components?s.components(t):s.components||t:i(s.components),a.createElement(r.Provider,{value:e},s.children)}}}]);