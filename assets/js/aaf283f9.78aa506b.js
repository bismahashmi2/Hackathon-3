"use strict";(globalThis.webpackChunkmy_book=globalThis.webpackChunkmy_book||[]).push([[7281],{1400(n,e,i){i.r(e),i.d(e,{assets:()=>a,contentTitle:()=>l,default:()=>m,frontMatter:()=>t,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"textbook/modules/ros2-integration/labs/lab-09-03","title":"Gazebo Simulation Integration","description":"Objectives","source":"@site/docs/textbook/modules/09-ros2-integration/labs/lab-09-03.md","sourceDirName":"textbook/modules/09-ros2-integration/labs","slug":"/textbook/modules/ros2-integration/labs/lab-09-03","permalink":"/Hackathon-3/docs/textbook/modules/ros2-integration/labs/lab-09-03","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/textbook/modules/09-ros2-integration/labs/lab-09-03.md","tags":[],"version":"current","frontMatter":{"id":"lab-09-03","module_id":"09","title":"Gazebo Simulation Integration","difficulty":"challenge","tier":"simulation","duration_minutes":120},"sidebar":"tutorialSidebar","previous":{"title":"tf2 and Coordinate Frames","permalink":"/Hackathon-3/docs/textbook/modules/ros2-integration/labs/lab-09-02"},"next":{"title":"ROS2 Integration","permalink":"/Hackathon-3/docs/textbook/modules/ros2-integration/ros2-integration"}}');var r=i(4848),o=i(8453);const t={id:"lab-09-03",module_id:"09",title:"Gazebo Simulation Integration",difficulty:"challenge",tier:"simulation",duration_minutes:120},l="Lab 09-03: Gazebo Simulation Integration",a={},c=[{value:"Objectives",id:"objectives",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Materials",id:"materials",level:2},{value:"Background",id:"background",level:2},{value:"Why Simulation?",id:"why-simulation",level:3},{value:"Gazebo-ROS2 Integration",id:"gazebo-ros2-integration",level:3},{value:"Sim-to-Real Gap",id:"sim-to-real-gap",level:3},{value:"Instructions",id:"instructions",level:2},{value:"Step 1: Set Up Gazebo Environment",id:"step-1-set-up-gazebo-environment",level:3},{value:"Step 2: Create Robot Model with Sensors",id:"step-2-create-robot-model-with-sensors",level:3},{value:"Step 3: Configure ROS-Gazebo Bridge",id:"step-3-configure-ros-gazebo-bridge",level:3},{value:"Step 4: Create Simulation Controller Node",id:"step-4-create-simulation-controller-node",level:3},{value:"Step 5: Implement Sensor Processing",id:"step-5-implement-sensor-processing",level:3},{value:"Step 6: Create Complete Launch System",id:"step-6-create-complete-launch-system",level:3},{value:"Expected Outcomes",id:"expected-outcomes",level:2},{value:"Rubric",id:"rubric",level:2},{value:"Common Errors",id:"common-errors",level:2},{value:"Extensions",id:"extensions",level:2},{value:"Related Content",id:"related-content",level:2}];function d(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"lab-09-03-gazebo-simulation-integration",children:"Lab 09-03: Gazebo Simulation Integration"})}),"\n",(0,r.jsx)(e.h2,{id:"objectives",children:"Objectives"}),"\n",(0,r.jsx)(e.p,{children:"By the end of this lab, you will be able to:"}),"\n",(0,r.jsxs)(e.ul,{className:"contains-task-list",children:["\n",(0,r.jsxs)(e.li,{className:"task-list-item",children:[(0,r.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Configure Gazebo simulation environments for robot testing"]}),"\n",(0,r.jsxs)(e.li,{className:"task-list-item",children:[(0,r.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Create ROS2-Gazebo bridges for sensor and actuator data"]}),"\n",(0,r.jsxs)(e.li,{className:"task-list-item",children:[(0,r.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Implement controllers that work in both simulation and reality"]}),"\n",(0,r.jsxs)(e.li,{className:"task-list-item",children:[(0,r.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Debug and optimize sim-to-real transfer issues"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Completed Labs 09-01 and 09-02"}),"\n",(0,r.jsx)(e.li,{children:"Understanding of URDF robot descriptions"}),"\n",(0,r.jsx)(e.li,{children:"Familiarity with physics simulation concepts"}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"materials",children:"Materials"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"Type"}),(0,r.jsx)(e.th,{children:"Name"}),(0,r.jsx)(e.th,{children:"Tier"}),(0,r.jsx)(e.th,{children:"Notes"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"software"}),(0,r.jsx)(e.td,{children:"Gazebo Fortress"}),(0,r.jsx)(e.td,{children:"required"}),(0,r.jsx)(e.td,{children:"gz-sim"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"software"}),(0,r.jsx)(e.td,{children:"ROS2 Humble"}),(0,r.jsx)(e.td,{children:"required"}),(0,r.jsx)(e.td,{children:"ros_gz_bridge"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"software"}),(0,r.jsx)(e.td,{children:"Python 3.10+"}),(0,r.jsx)(e.td,{children:"required"}),(0,r.jsx)(e.td,{children:"Control nodes"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"model"}),(0,r.jsx)(e.td,{children:"Robot URDF/SDF"}),(0,r.jsx)(e.td,{children:"required"}),(0,r.jsx)(e.td,{children:"Robot description"})]})]})]}),"\n",(0,r.jsx)(e.h2,{id:"background",children:"Background"}),"\n",(0,r.jsx)(e.h3,{id:"why-simulation",children:"Why Simulation?"}),"\n",(0,r.jsx)(e.p,{children:"Simulation enables:"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Safe development without hardware damage"}),"\n",(0,r.jsx)(e.li,{children:"Parallelized testing across scenarios"}),"\n",(0,r.jsx)(e.li,{children:"Perfect ground truth for debugging"}),"\n",(0,r.jsx)(e.li,{children:"Reproducible experiments"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"gazebo-ros2-integration",children:"Gazebo-ROS2 Integration"}),"\n",(0,r.jsx)(e.p,{children:"Modern stack uses:"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Gazebo (Ignition)"}),": Physics simulation, rendering"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"ros_gz_bridge"}),": Topic/service bridging"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"ros_gz_sim"}),": Spawn and control interface"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"ros2_control"}),": Hardware abstraction layer"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"sim-to-real-gap",children:"Sim-to-Real Gap"}),"\n",(0,r.jsx)(e.p,{children:"Challenges in transfer:"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Physics model inaccuracies"}),"\n",(0,r.jsx)(e.li,{children:"Sensor noise differences"}),"\n",(0,r.jsx)(e.li,{children:"Timing and latency"}),"\n",(0,r.jsx)(e.li,{children:"Environmental variations"}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"instructions",children:"Instructions"}),"\n",(0,r.jsx)(e.h3,{id:"step-1-set-up-gazebo-environment",children:"Step 1: Set Up Gazebo Environment"}),"\n",(0,r.jsx)(e.p,{children:"Create a simulation world:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-xml",children:'<?xml version="1.0" ?>\n\x3c!-- world.sdf --\x3e\n<sdf version="1.8">\n  <world name="robot_world">\n\n    \x3c!-- Physics configuration --\x3e\n    <physics name="1ms" type="ignored">\n      <max_step_size>0.001</max_step_size>\n      <real_time_factor>1.0</real_time_factor>\n    </physics>\n\n    \x3c!-- Plugins --\x3e\n    <plugin\n      filename="gz-sim-physics-system"\n```python\n```python\n      name="gz::sim::systems::Physics">\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'    </plugin>\n    <plugin\n      filename="gz-sim-sensors-system"\n```python\n```python\n      name="gz::sim::systems::Sensors">\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'      <render_engine>ogre2</render_engine>\n    </plugin>\n    <plugin\n      filename="gz-sim-scene-broadcaster-system"\n```python\n```python\n      name="gz::sim::systems::SceneBroadcaster">\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'    </plugin>\n    <plugin\n      filename="gz-sim-user-commands-system"\n```python\n```python\n      name="gz::sim::systems::UserCommands">\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'    </plugin>\n\n    \x3c!-- Lighting --\x3e\n    <light type="directional" name="sun">\n      <cast_shadows>true</cast_shadows>\n      <pose>0 0 10 0 0 0</pose>\n      <diffuse>0.8 0.8 0.8 1</diffuse>\n      <specular>0.2 0.2 0.2 1</specular>\n      <direction>-0.5 0.1 -0.9</direction>\n    </light>\n\n    \x3c!-- Ground plane --\x3e\n    <model name="ground_plane">\n      <static>true</static>\n      <link name="link">\n        <collision name="collision">\n          <geometry>\n            <plane>\n              <normal>0 0 1</normal>\n              <size>100 100</size>\n            </plane>\n          </geometry>\n          <surface>\n            <friction>\n              <ode>\n                <mu>0.8</mu>\n                <mu2>0.8</mu2>\n              </ode>\n            </friction>\n          </surface>\n        </collision>\n        <visual name="visual">\n          <geometry>\n            <plane>\n              <normal>0 0 1</normal>\n              <size>100 100</size>\n            </plane>\n          </geometry>\n          <material>\n            <ambient>0.3 0.3 0.3 1</ambient>\n          </material>\n        </visual>\n      </link>\n    </model>\n\n    \x3c!-- Test objects --\x3e\n    <include>\n      <uri>model://box</uri>\n      <name>target_box</name>\n      <pose>1 0 0.05 0 0 0</pose>\n    </include>\n\n  </world>\n</sdf>\n'})}),"\n",(0,r.jsx)(e.p,{children:"Launch Gazebo:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# Set Gazebo resource path\nexport GZ_SIM_RESOURCE_PATH=/path/to/models\n\n# Launch world\ngz sim world.sdf\n"})}),"\n",(0,r.jsx)("checkpoint",{children:(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Expected"}),": Gazebo opens with ground plane and lighting visible."]})}),"\n",(0,r.jsx)(e.h3,{id:"step-2-create-robot-model-with-sensors",children:"Step 2: Create Robot Model with Sensors"}),"\n",(0,r.jsx)(e.p,{children:"Define robot with sensors in SDF:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-xml",children:'<?xml version="1.0" ?>\n\x3c!-- robot.sdf --\x3e\n<sdf version="1.8">\n  <model name="simple_arm">\n    <pose>0 0 0.1 0 0 0</pose>\n\n    \x3c!-- Base link --\x3e\n    <link name="base_link">\n      <inertial>\n        <mass>5.0</mass>\n        <inertia>\n          <ixx>0.1</ixx>\n          <iyy>0.1</iyy>\n          <izz>0.1</izz>\n        </inertia>\n      </inertial>\n      <visual name="visual">\n        <geometry>\n          <cylinder>\n            <radius>0.1</radius>\n            <length>0.2</length>\n          </cylinder>\n        </geometry>\n      </visual>\n      <collision name="collision">\n        <geometry>\n          <cylinder>\n            <radius>0.1</radius>\n            <length>0.2</length>\n          </cylinder>\n        </geometry>\n      </collision>\n    </link>\n\n    \x3c!-- Link 1 --\x3e\n    <link name="link1">\n      <pose relative_to="joint1">0 0 0.2 0 0 0</pose>\n      <inertial>\n        <mass>2.0</mass>\n        <inertia>\n          <ixx>0.02</ixx>\n          <iyy>0.02</iyy>\n          <izz>0.01</izz>\n        </inertia>\n      </inertial>\n      <visual name="visual">\n        <geometry>\n          <box>\n            <size>0.05 0.05 0.4</size>\n          </box>\n        </geometry>\n        <material>\n          <ambient>0.2 0.2 0.8 1</ambient>\n        </material>\n      </visual>\n      <collision name="collision">\n        <geometry>\n          <box>\n            <size>0.05 0.05 0.4</size>\n          </box>\n        </geometry>\n      </collision>\n    </link>\n\n    \x3c!-- Joint 1 --\x3e\n    <joint name="joint1" type="revolute">\n      <parent>base_link</parent>\n      <child>link1</child>\n      <pose>0 0 0.1 0 0 0</pose>\n      <axis>\n        <xyz>0 0 1</xyz>\n        <limit>\n          <lower>-3.14</lower>\n          <upper>3.14</upper>\n          <effort>50</effort>\n          <velocity>2</velocity>\n        </limit>\n        <dynamics>\n          <damping>0.5</damping>\n          <friction>0.1</friction>\n        </dynamics>\n      </axis>\n    </joint>\n\n    \x3c!-- Link 2 --\x3e\n    <link name="link2">\n      <pose relative_to="joint2">0 0 0.15 0 0 0</pose>\n      <inertial>\n        <mass>1.5</mass>\n        <inertia>\n          <ixx>0.01</ixx>\n          <iyy>0.01</iyy>\n          <izz>0.005</izz>\n        </inertia>\n      </inertial>\n      <visual name="visual">\n        <geometry>\n          <box>\n            <size>0.04 0.04 0.3</size>\n          </box>\n        </geometry>\n        <material>\n          <ambient>0.2 0.8 0.2 1</ambient>\n        </material>\n      </visual>\n      <collision name="collision">\n        <geometry>\n          <box>\n            <size>0.04 0.04 0.3</size>\n          </box>\n        </geometry>\n      </collision>\n\n      \x3c!-- Camera sensor --\x3e\n      <sensor name="camera" type="camera">\n        <pose>0 0 0.15 0 0 0</pose>\n        <camera>\n          <horizontal_fov>1.047</horizontal_fov>\n          <image>\n            <width>640</width>\n            <height>480</height>\n          </image>\n          <clip>\n            <near>0.1</near>\n            <far>10</far>\n          </clip>\n        </camera>\n        <always_on>1</always_on>\n        <update_rate>30</update_rate>\n        <topic>camera</topic>\n      </sensor>\n    </link>\n\n    \x3c!-- Joint 2 --\x3e\n    <joint name="joint2" type="revolute">\n      <parent>link1</parent>\n      <child>link2</child>\n      <pose relative_to="link1">0 0 0.2 0 0 0</pose>\n      <axis>\n        <xyz>0 1 0</xyz>\n        <limit>\n          <lower>-2.0</lower>\n          <upper>2.0</upper>\n          <effort>30</effort>\n          <velocity>2</velocity>\n        </limit>\n        <dynamics>\n          <damping>0.3</damping>\n          <friction>0.1</friction>\n        </dynamics>\n      </axis>\n    </joint>\n\n    \x3c!-- Joint state publisher plugin --\x3e\n    <plugin\n      filename="gz-sim-joint-state-publisher-system"\n```python\n```python\n      name="gz::sim::systems::JointStatePublisher">\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'      <joint_name>joint1</joint_name>\n      <joint_name>joint2</joint_name>\n      <topic>joint_states</topic>\n      <update_rate>100</update_rate>\n    </plugin>\n\n    \x3c!-- Joint position controller plugin --\x3e\n    <plugin\n      filename="gz-sim-joint-position-controller-system"\n```python\n```python\n      name="gz::sim::systems::JointPositionController">\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'      <joint_name>joint1</joint_name>\n      <topic>joint1_cmd</topic>\n      <p_gain>100</p_gain>\n      <d_gain>10</d_gain>\n    </plugin>\n\n    <plugin\n      filename="gz-sim-joint-position-controller-system"\n```python\n```python\n      name="gz::sim::systems::JointPositionController">\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"      <joint_name>joint2</joint_name>\n      <topic>joint2_cmd</topic>\n      <p_gain>80</p_gain>\n      <d_gain>8</d_gain>\n    </plugin>\n\n  </model>\n</sdf>\n"})}),"\n",(0,r.jsx)("checkpoint",{children:(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Expected"}),": Robot model spawns with two joints and camera sensor."]})}),"\n",(0,r.jsx)(e.h3,{id:"step-3-configure-ros-gazebo-bridge",children:"Step 3: Configure ROS-Gazebo Bridge"}),"\n",(0,r.jsx)(e.p,{children:"Set up topic bridges:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:'# bridge_config.yaml\n# ROS2-Gazebo bridge configuration\n\n- ros_topic_name: "/joint_states"\n  gz_topic_name: "/world/robot_world/model/simple_arm/joint_states"\n  ros_type_name: "sensor_msgs/msg/JointState"\n  gz_type_name: "gz.msgs.Model"\n  direction: GZ_TO_ROS\n\n- ros_topic_name: "/joint1_cmd"\n  gz_topic_name: "/model/simple_arm/joint/joint1/cmd_pos"\n  ros_type_name: "std_msgs/msg/Float64"\n  gz_type_name: "gz.msgs.Double"\n  direction: ROS_TO_GZ\n\n- ros_topic_name: "/joint2_cmd"\n  gz_topic_name: "/model/simple_arm/joint/joint2/cmd_pos"\n  ros_type_name: "std_msgs/msg/Float64"\n  gz_type_name: "gz.msgs.Double"\n  direction: ROS_TO_GZ\n\n- ros_topic_name: "/camera/image_raw"\n  gz_topic_name: "/camera"\n  ros_type_name: "sensor_msgs/msg/Image"\n  gz_type_name: "gz.msgs.Image"\n  direction: GZ_TO_ROS\n\n- ros_topic_name: "/camera/camera_info"\n  gz_topic_name: "/camera_info"\n  ros_type_name: "sensor_msgs/msg/CameraInfo"\n  gz_type_name: "gz.msgs.CameraInfo"\n  direction: GZ_TO_ROS\n'})}),"\n",(0,r.jsx)(e.p,{children:"Launch bridge:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"ros2 run ros_gz_bridge parameter_bridge --ros-args -p config_file:=bridge_config.yaml\n"})}),"\n",(0,r.jsx)("checkpoint",{children:(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Expected"}),": ROS2 topics appear for joint states, commands, and camera."]})}),"\n",(0,r.jsx)(e.h3,{id:"step-4-create-simulation-controller-node",children:"Step 4: Create Simulation Controller Node"}),"\n",(0,r.jsx)(e.p,{children:"Implement a controller that works with simulation:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"#!/usr/bin/env python3\n\"\"\"\ngazebo_controller.py\nController node for Gazebo simulation.\n\"\"\"\n\nimport rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import JointState, Image\nfrom std_msgs.msg import Float64\nfrom geometry_msgs.msg import Pose\nfrom cv_bridge import CvBridge\nimport numpy as np\n\nclass GazeboController(Node):\n    \"\"\"Control robot in Gazebo simulation.\"\"\"\n\n    def __init__(self):\n        super().__init__('gazebo_controller')\n\n        # Parameters\n        self.declare_parameter('control_rate', 100.0)\n        self.declare_parameter('use_sim_time', True)\n\n        control_rate = self.get_parameter('control_rate').value\n\n        # Publishers for joint commands\n        self.joint1_pub = self.create_publisher(Float64, '/joint1_cmd', 10)\n        self.joint2_pub = self.create_publisher(Float64, '/joint2_cmd', 10)\n\n        # Subscribers\n        self.joint_sub = self.create_subscription(\n            JointState,\n            '/joint_states',\n            self.joint_callback,\n            10\n        )\n\n        self.image_sub = self.create_subscription(\n            Image,\n            '/camera/image_raw',\n            self.image_callback,\n            10\n        )\n\n        # State\n        self.current_joints = np.zeros(2)\n        self.target_joints = np.zeros(2)\n        self.cv_bridge = CvBridge()\n        self.last_image = None\n\n        # Control timer\n        self.timer = self.create_timer(1.0 / control_rate, self.control_loop)\n        self.time = 0.0\n\n        # Trajectory parameters\n        self.trajectory_mode = 'sinusoidal'\n\n        self.get_logger().info('Gazebo controller initialized')\n\n    def joint_callback(self, msg):\n        \"\"\"Update current joint positions.\"\"\"\n```python\n```python\n        if len(msg.position) >= 2:\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'            self.current_joints = np.array(msg.position[:2])\n\n    def image_callback(self, msg):\n        """Process camera image."""\n        try:\n            self.last_image = self.cv_bridge.imgmsg_to_cv2(msg, \'bgr8\')\n        except Exception as e:\n            self.get_logger().error(f\'Image conversion failed: {e}\')\n\n    def control_loop(self):\n        """Main control loop."""\n        self.time += 0.01\n\n        # Generate trajectory\n```python\n```python\n        if self.trajectory_mode == \'sinusoidal\':\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"            self.target_joints[0] = 1.0 * np.sin(2 * np.pi * 0.2 * self.time)\n            self.target_joints[1] = 0.5 * np.sin(2 * np.pi * 0.3 * self.time)\n\n        elif self.trajectory_mode == 'step':\n```python\n```python\n            if int(self.time) % 4 < 2:\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"                self.target_joints = np.array([0.5, 0.3])\n            else:\n                self.target_joints = np.array([-0.5, -0.3])\n\n        # Publish commands\n        msg1 = Float64()\n        msg1.data = float(self.target_joints[0])\n        self.joint1_pub.publish(msg1)\n\n        msg2 = Float64()\n        msg2.data = float(self.target_joints[1])\n        self.joint2_pub.publish(msg2)\n\n        # Compute and log error\n        error = self.target_joints - self.current_joints\n```python\n```python\n        if int(self.time * 10) % 50 == 0:\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"            self.get_logger().info(\n                f't={self.time:.1f}s: error=[{error[0]:.3f}, {error[1]:.3f}]'\n            )\n\n    def set_trajectory_mode(self, mode):\n        \"\"\"Set trajectory generation mode.\"\"\"\n        if mode in ['sinusoidal', 'step', 'waypoint']:\n            self.trajectory_mode = mode\n            self.get_logger().info(f'Trajectory mode: {mode}')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = GazeboController()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\n```python\n```python\nif __name__ == '__main__':\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"    main()\n"})}),"\n",(0,r.jsx)("checkpoint",{children:(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Expected"}),": Robot follows sinusoidal trajectory in Gazebo, tracking error displayed."]})}),"\n",(0,r.jsx)(e.h3,{id:"step-5-implement-sensor-processing",children:"Step 5: Implement Sensor Processing"}),"\n",(0,r.jsx)(e.p,{children:"Process simulated sensors:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'#!/usr/bin/env python3\n"""\nsensor_processor.py\nProcess sensor data from Gazebo.\n"""\n\nimport rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import Image, CameraInfo, LaserScan\nfrom geometry_msgs.msg import PoseArray, Pose\nfrom cv_bridge import CvBridge\nimport cv2\nimport numpy as np\n\nclass SensorProcessor(Node):\n    """Process simulated sensor data."""\n\n    def __init__(self):\n        super().__init__(\'sensor_processor\')\n\n        self.cv_bridge = CvBridge()\n\n        # Camera subscriber\n        self.image_sub = self.create_subscription(\n            Image,\n            \'/camera/image_raw\',\n            self.image_callback,\n            10\n        )\n\n        self.camera_info_sub = self.create_subscription(\n            CameraInfo,\n            \'/camera/camera_info\',\n            self.camera_info_callback,\n            10\n        )\n\n        # Detection publisher\n        self.detection_pub = self.create_publisher(\n            PoseArray,\n            \'/detections\',\n            10\n        )\n\n        # Camera intrinsics\n        self.camera_matrix = None\n\n        self.get_logger().info(\'Sensor processor started\')\n\n    def camera_info_callback(self, msg):\n        """Store camera intrinsics."""\n        self.camera_matrix = np.array(msg.k).reshape(3, 3)\n\n    def image_callback(self, msg):\n        """Process camera image for object detection."""\n        try:\n            # Convert to OpenCV\n            cv_image = self.cv_bridge.imgmsg_to_cv2(msg, \'bgr8\')\n\n            # Simple color-based detection (for demo)\n            detections = self.detect_colored_objects(cv_image)\n\n            # Publish detections\n            if detections:\n                pose_array = PoseArray()\n                pose_array.header = msg.header\n\n                for det in detections:\n                    pose = Pose()\n                    pose.position.x = det[\'center\'][0]\n                    pose.position.y = det[\'center\'][1]\n                    pose.position.z = det[\'area\']\n                    pose_array.poses.append(pose)\n\n                self.detection_pub.publish(pose_array)\n                self.get_logger().info(f\'Detected {len(detections)} objects\')\n\n        except Exception as e:\n            self.get_logger().error(f\'Image processing failed: {e}\')\n\n    def detect_colored_objects(self, image):\n        """Detect colored objects in image."""\n        detections = []\n\n        # Convert to HSV\n        hsv = cv2.cvtColor(image, cv2.COLOR_BGR2HSV)\n\n        # Define color ranges (red objects)\n        lower_red = np.array([0, 100, 100])\n        upper_red = np.array([10, 255, 255])\n\n        # Create mask\n        mask = cv2.inRange(hsv, lower_red, upper_red)\n\n        # Find contours\n        contours, _ = cv2.findContours(\n            mask, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE\n        )\n\n        for contour in contours:\n            area = cv2.contourArea(contour)\n```python\n```python\n            if area > 100:  # Minimum area threshold\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"                M = cv2.moments(contour)\n```python\n```python\n                if M['m00'] > 0:\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"                    cx = int(M['m10'] / M['m00'])\n                    cy = int(M['m01'] / M['m00'])\n                    detections.append({\n                        'center': (cx, cy),\n                        'area': area,\n                        'contour': contour\n                    })\n\n        return detections\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = SensorProcessor()\n    rclpy.spin(node)\n    node.destroy_node()\n    rclpy.shutdown()\n\n```python\n```python\nif __name__ == '__main__':\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"    main()\n"})}),"\n",(0,r.jsx)("checkpoint",{children:(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Expected"}),": Colored objects detected in camera feed, detections published."]})}),"\n",(0,r.jsx)(e.h3,{id:"step-6-create-complete-launch-system",children:"Step 6: Create Complete Launch System"}),"\n",(0,r.jsx)(e.p,{children:"Integrated launch file:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:"#!/usr/bin/env python3\n\"\"\"\nsimulation_launch.py\nComplete simulation launch file.\n\"\"\"\n\nfrom launch import LaunchDescription\nfrom launch.actions import (\n    DeclareLaunchArgument,\n    ExecuteProcess,\n    IncludeLaunchDescription,\n    SetEnvironmentVariable\n)\nfrom launch.launch_description_sources import PythonLaunchDescriptionSource\nfrom launch.substitutions import LaunchConfiguration, PathJoinSubstitution\nfrom launch_ros.actions import Node\nfrom launch_ros.substitutions import FindPackageShare\nimport os\n\ndef generate_launch_description():\n    \"\"\"Generate complete simulation launch.\"\"\"\n\n    # Environment variables\n    gz_resource_path = SetEnvironmentVariable(\n        'GZ_SIM_RESOURCE_PATH',\n        '/path/to/models'\n    )\n\n    # Arguments\n    world_arg = DeclareLaunchArgument(\n        'world',\n        default_value='robot_world.sdf',\n        description='World file'\n    )\n\n    use_sim_time_arg = DeclareLaunchArgument(\n        'use_sim_time',\n        default_value='true',\n        description='Use simulation time'\n    )\n\n    # Gazebo simulation\n    gazebo = ExecuteProcess(\n        cmd=['gz', 'sim', '-r', LaunchConfiguration('world')],\n        output='screen'\n    )\n\n    # Spawn robot\n    spawn_robot = ExecuteProcess(\n        cmd=[\n            'gz', 'service', '-s', '/world/robot_world/create',\n            '--reqtype', 'gz.msgs.EntityFactory',\n            '--reptype', 'gz.msgs.Boolean',\n            '--timeout', '5000',\n            '--req', 'sdf_filename: \"robot.sdf\" name: \"simple_arm\"'\n        ],\n        output='screen'\n    )\n\n    # ROS-Gazebo bridge\n    bridge = Node(\n        package='ros_gz_bridge',\n        executable='parameter_bridge',\n        arguments=[\n            '/joint_states@sensor_msgs/msg/JointState[gz.msgs.Model',\n            '/joint1_cmd@std_msgs/msg/Float64]gz.msgs.Double',\n            '/joint2_cmd@std_msgs/msg/Float64]gz.msgs.Double',\n            '/camera@sensor_msgs/msg/Image[gz.msgs.Image',\n        ],\n        parameters=[{'use_sim_time': LaunchConfiguration('use_sim_time')}],\n        output='screen'\n    )\n\n    # Robot controller\n    controller = Node(\n        package='physical_ai_textbook',\n        executable='gazebo_controller',\n        name='gazebo_controller',\n        parameters=[{\n            'use_sim_time': LaunchConfiguration('use_sim_time'),\n            'control_rate': 100.0\n        }],\n        output='screen'\n    )\n\n    # Sensor processor\n    sensor_proc = Node(\n        package='physical_ai_textbook',\n        executable='sensor_processor',\n        name='sensor_processor',\n        parameters=[{'use_sim_time': LaunchConfiguration('use_sim_time')}],\n        output='screen'\n    )\n\n    # TF broadcaster\n    tf_broadcaster = Node(\n        package='physical_ai_textbook',\n        executable='dynamic_tf_broadcaster',\n        name='tf_broadcaster',\n        parameters=[{'use_sim_time': LaunchConfiguration('use_sim_time')}],\n        output='screen'\n    )\n\n    # RViz\n    rviz = Node(\n        package='rviz2',\n        executable='rviz2',\n        arguments=['-d', 'simulation.rviz'],\n        parameters=[{'use_sim_time': LaunchConfiguration('use_sim_time')}],\n        output='screen'\n    )\n\n    return LaunchDescription([\n        gz_resource_path,\n        world_arg,\n        use_sim_time_arg,\n        gazebo,\n        spawn_robot,\n        bridge,\n        controller,\n        sensor_proc,\n        tf_broadcaster,\n        rviz\n    ])\n"})}),"\n",(0,r.jsx)("checkpoint",{children:(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Expected"}),": Full system launches with Gazebo, ROS2 nodes, and RViz."]})}),"\n",(0,r.jsx)(e.h2,{id:"expected-outcomes",children:"Expected Outcomes"}),"\n",(0,r.jsx)(e.p,{children:"After completing this lab, you should have:"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Code artifacts"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"world.sdf"}),": Simulation world"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"robot.sdf"}),": Robot with sensors"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"bridge_config.yaml"}),": ROS-Gazebo bridges"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"gazebo_controller.py"}),": Robot controller"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"sensor_processor.py"}),": Sensor processing"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"simulation_launch.py"}),": Complete launch"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Understanding"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Gazebo-ROS2 integration architecture"}),"\n",(0,r.jsx)(e.li,{children:"SDF model creation with sensors"}),"\n",(0,r.jsx)(e.li,{children:"Bridge configuration for data flow"}),"\n",(0,r.jsx)(e.li,{children:"Simulation time synchronization"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Running system"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Robot controlled via ROS2 in Gazebo"}),"\n",(0,r.jsx)(e.li,{children:"Sensor data available in ROS2"}),"\n",(0,r.jsx)(e.li,{children:"Visualization in RViz"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"rubric",children:"Rubric"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"Criterion"}),(0,r.jsx)(e.th,{children:"Points"}),(0,r.jsx)(e.th,{children:"Description"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"World Setup"}),(0,r.jsx)(e.td,{children:"15"}),(0,r.jsx)(e.td,{children:"Physics, lighting, ground plane"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"Robot Model"}),(0,r.jsx)(e.td,{children:"25"}),(0,r.jsx)(e.td,{children:"Joints, links, sensors working"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"ROS Bridge"}),(0,r.jsx)(e.td,{children:"20"}),(0,r.jsx)(e.td,{children:"Bidirectional data flow"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"Controller"}),(0,r.jsx)(e.td,{children:"20"}),(0,r.jsx)(e.td,{children:"Trajectory tracking in sim"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"Integration"}),(0,r.jsx)(e.td,{children:"20"}),(0,r.jsx)(e.td,{children:"Launch file, full system"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:(0,r.jsx)(e.strong,{children:"Total"})}),(0,r.jsx)(e.td,{children:(0,r.jsx)(e.strong,{children:"100"})}),(0,r.jsx)(e.td,{})]})]})]}),"\n",(0,r.jsx)(e.h2,{id:"common-errors",children:"Common Errors"}),"\n",(0,r.jsxs)("troubleshooting",{children:[(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Error"}),": Bridge not connecting\n",(0,r.jsx)(e.strong,{children:"Solution"}),": Check topic names match exactly, verify Gazebo plugins loaded."]}),(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Error"}),": Robot falls through ground\n",(0,r.jsx)(e.strong,{children:"Solution"}),": Check collision geometry, verify physics plugin enabled."]}),(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Error"}),": Sensors not publishing\n",(0,r.jsx)(e.strong,{children:"Solution"}),": Verify sensor plugins in SDF, check update rates."]})]}),"\n",(0,r.jsx)(e.h2,{id:"extensions",children:"Extensions"}),"\n",(0,r.jsx)(e.p,{children:"For advanced students:"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Domain Randomization"}),": Vary physics parameters for robustness"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Multi-Robot"}),": Spawn and coordinate multiple robots"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Terrain Generation"}),": Procedural terrain for testing"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Hardware-in-Loop"}),": Mix real sensors with simulated robot"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"related-content",children:"Related Content"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Theory"}),": Module 09 theory.md, Section 9.3 (Simulation)"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Previous Lab"}),": Lab 09-02 (tf2)"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Next Module"}),": Module 10 (Sim-to-Real Transfer)"]}),"\n"]})]})}function m(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}},8453(n,e,i){i.d(e,{R:()=>t,x:()=>l});var s=i(6540);const r={},o=s.createContext(r);function t(n){const e=s.useContext(o);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:t(n.components),s.createElement(o.Provider,{value:e},n.children)}}}]);