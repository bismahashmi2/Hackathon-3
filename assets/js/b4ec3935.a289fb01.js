"use strict";(globalThis.webpackChunkmy_book=globalThis.webpackChunkmy_book||[]).push([[3765],{8122(e,n,s){s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"textbook/modules/ros2-integration/labs/lab-09-01","title":"ROS2 Fundamentals and Communication","description":"Objectives","source":"@site/docs/textbook/modules/09-ros2-integration/labs/lab-09-01.md","sourceDirName":"textbook/modules/09-ros2-integration/labs","slug":"/textbook/modules/ros2-integration/labs/lab-09-01","permalink":"/Hackathon-3/docs/textbook/modules/ros2-integration/labs/lab-09-01","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/textbook/modules/09-ros2-integration/labs/lab-09-01.md","tags":[],"version":"current","frontMatter":{"id":"lab-09-01","module_id":"09","title":"ROS2 Fundamentals and Communication","difficulty":"guided","tier":"simulation","duration_minutes":75},"sidebar":"tutorialSidebar","previous":{"title":"Ethics in Robot Software Systems","permalink":"/Hackathon-3/docs/textbook/modules/ros2-integration/ethics"},"next":{"title":"tf2 and Coordinate Frames","permalink":"/Hackathon-3/docs/textbook/modules/ros2-integration/labs/lab-09-02"}}');var i=s(4848),t=s(8453);const o={id:"lab-09-01",module_id:"09",title:"ROS2 Fundamentals and Communication",difficulty:"guided",tier:"simulation",duration_minutes:75},l="Lab 09-01: ROS2 Fundamentals and Communication",a={},c=[{value:"Objectives",id:"objectives",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Materials",id:"materials",level:2},{value:"Background",id:"background",level:2},{value:"Why ROS2?",id:"why-ros2",level:3},{value:"Communication Patterns",id:"communication-patterns",level:3},{value:"Quality of Service (QoS)",id:"quality-of-service-qos",level:3},{value:"Instructions",id:"instructions",level:2},{value:"Step 1: Set Up ROS2 Environment",id:"step-1-set-up-ros2-environment",level:3},{value:"Step 2: Create a Simple Publisher Node",id:"step-2-create-a-simple-publisher-node",level:3},{value:"Step 3: Create a Subscriber Node",id:"step-3-create-a-subscriber-node",level:3},{value:"Step 4: Implement a ROS2 Service",id:"step-4-implement-a-ros2-service",level:3},{value:"Step 5: Create Launch File",id:"step-5-create-launch-file",level:3},{value:"Step 6: QoS Configuration for Real-Time",id:"step-6-qos-configuration-for-real-time",level:3},{value:"Expected Outcomes",id:"expected-outcomes",level:2},{value:"Rubric",id:"rubric",level:2},{value:"Common Errors",id:"common-errors",level:2},{value:"Extensions",id:"extensions",level:2},{value:"Related Content",id:"related-content",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"lab-09-01-ros2-fundamentals-and-communication",children:"Lab 09-01: ROS2 Fundamentals and Communication"})}),"\n",(0,i.jsx)(n.h2,{id:"objectives",children:"Objectives"}),"\n",(0,i.jsx)(n.p,{children:"By the end of this lab, you will be able to:"}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Create ROS2 nodes for robot control"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Implement publishers and subscribers for sensor/actuator data"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Use ROS2 services for discrete commands"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Understand and apply QoS settings for real-time robotics"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Completed Module 05 (Dynamics and Control)"}),"\n",(0,i.jsx)(n.li,{children:"Basic Python programming skills"}),"\n",(0,i.jsx)(n.li,{children:"Docker installed for containerized ROS2 environment"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"materials",children:"Materials"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Name"}),(0,i.jsx)(n.th,{children:"Tier"}),(0,i.jsx)(n.th,{children:"Notes"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"software"}),(0,i.jsx)(n.td,{children:"ROS2 Humble"}),(0,i.jsx)(n.td,{children:"required"}),(0,i.jsx)(n.td,{children:"Robot Operating System"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"software"}),(0,i.jsx)(n.td,{children:"Python 3.10+"}),(0,i.jsx)(n.td,{children:"required"}),(0,i.jsx)(n.td,{children:"rclpy interface"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"software"}),(0,i.jsx)(n.td,{children:"Docker"}),(0,i.jsx)(n.td,{children:"required"}),(0,i.jsx)(n.td,{children:"Containerized environment"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"simulation"}),(0,i.jsx)(n.td,{children:"Gazebo Fortress"}),(0,i.jsx)(n.td,{children:"required"}),(0,i.jsx)(n.td,{children:"Simulation backend"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"background",children:"Background"}),"\n",(0,i.jsx)(n.h3,{id:"why-ros2",children:"Why ROS2?"}),"\n",(0,i.jsx)(n.p,{children:"ROS2 provides:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Standardized interfaces for robot components"}),"\n",(0,i.jsx)(n.li,{children:"Real-time capable communication (DDS)"}),"\n",(0,i.jsx)(n.li,{children:"Multi-platform support (Linux, Windows, macOS)"}),"\n",(0,i.jsx)(n.li,{children:"Lifecycle management for production systems"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"communication-patterns",children:"Communication Patterns"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Topics"}),": Continuous data streams (sensors, commands)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Services"}),": Request/response (discrete operations)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Actions"}),": Long-running tasks with feedback"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"quality-of-service-qos",children:"Quality of Service (QoS)"}),"\n",(0,i.jsx)(n.p,{children:"QoS profiles control:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Reliability"}),": Best-effort vs. reliable delivery"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Durability"}),": Transient vs. volatile data"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"History"}),": How many messages to buffer"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Deadline"}),": Maximum time between messages"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"instructions",children:"Instructions"}),"\n",(0,i.jsx)(n.h3,{id:"step-1-set-up-ros2-environment",children:"Step 1: Set Up ROS2 Environment"}),"\n",(0,i.jsx)(n.p,{children:"Launch the Docker container with ROS2:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Pull the ROS2 Humble image with Gazebo\ndocker pull ros:humble-ros-base\n\n# Run with display forwarding (Linux)\ndocker run -it --rm \\\n  -e DISPLAY=$DISPLAY \\\n  -v /tmp/.X11-unix:/tmp/.X11-unix \\\n  -v $(pwd)/textbook:/textbook \\\n  --network host \\\n  ros:humble-ros-base \\\n  bash\n"})}),"\n",(0,i.jsx)(n.p,{children:"Inside the container, verify ROS2:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Source ROS2\nsource /opt/ros/humble/setup.bash\n\n# Check installation\nros2 --version\nros2 topic list\n"})}),"\n",(0,i.jsx)("checkpoint",{children:(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Expected"}),": ROS2 command returns version, ",(0,i.jsx)(n.code,{children:"ros2 topic list"})," shows ",(0,i.jsx)(n.code,{children:"/rosout"}),"."]})}),"\n",(0,i.jsx)(n.h3,{id:"step-2-create-a-simple-publisher-node",children:"Step 2: Create a Simple Publisher Node"}),"\n",(0,i.jsx)(n.p,{children:"Create a joint command publisher:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\n"""\njoint_publisher.py\nPublishes joint position commands to a robot.\n"""\n\nimport rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import Float64MultiArray\nfrom rclpy.qos import QoSProfile, ReliabilityPolicy, HistoryPolicy\nimport numpy as np\n\nclass JointCommandPublisher(Node):\n    """Publishes joint commands at a fixed rate."""\n\n    def __init__(self):\n        super().__init__(\'joint_command_publisher\')\n\n        # QoS profile for real-time control\n        qos_profile = QoSProfile(\n            reliability=ReliabilityPolicy.RELIABLE,\n            history=HistoryPolicy.KEEP_LAST,\n            depth=10\n        )\n\n        # Create publisher\n        self.publisher = self.create_publisher(\n            Float64MultiArray,\n            \'/joint_commands\',\n            qos_profile\n        )\n\n        # Timer for periodic publishing (100 Hz)\n        self.timer = self.create_timer(0.01, self.timer_callback)\n\n        # State\n        self.time = 0.0\n        self.joint_positions = np.zeros(7)  # 7-DOF arm\n\n        self.get_logger().info(\'Joint command publisher initialized\')\n\n    def timer_callback(self):\n        """Publish joint commands."""\n        self.time += 0.01\n\n        # Generate sinusoidal motion for first two joints\n        self.joint_positions[0] = 0.5 * np.sin(2 * np.pi * 0.2 * self.time)\n        self.joint_positions[1] = 0.3 * np.sin(2 * np.pi * 0.3 * self.time)\n\n        # Create message\n        msg = Float64MultiArray()\n        msg.data = self.joint_positions.tolist()\n\n        # Publish\n        self.publisher.publish(msg)\n\n        # Log periodically\n```python\n```python\n        if int(self.time * 10) % 50 == 0:\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"            self.get_logger().info(f't={self.time:.1f}s: q[0]={self.joint_positions[0]:.3f}')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = JointCommandPublisher()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\n```python\n```python\nif __name__ == '__main__':\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"    main()\n"})}),"\n",(0,i.jsx)(n.p,{children:"Run the publisher:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# In one terminal\npython3 joint_publisher.py\n\n# In another terminal\nros2 topic list\nros2 topic echo /joint_commands\n"})}),"\n",(0,i.jsx)("checkpoint",{children:(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Expected"}),": Topic ",(0,i.jsx)(n.code,{children:"/joint_commands"})," appears, echoing shows Float64MultiArray messages at 100 Hz."]})}),"\n",(0,i.jsx)(n.h3,{id:"step-3-create-a-subscriber-node",children:"Step 3: Create a Subscriber Node"}),"\n",(0,i.jsx)(n.p,{children:"Create a joint state subscriber:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\n"""\njoint_subscriber.py\nSubscribes to joint states and computes control errors.\n"""\n\nimport rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import Float64MultiArray\nfrom rclpy.qos import QoSProfile, ReliabilityPolicy, HistoryPolicy\nimport numpy as np\n\nclass JointStateSubscriber(Node):\n    """Subscribes to joint states and commands, computes errors."""\n\n    def __init__(self):\n        super().__init__(\'joint_state_subscriber\')\n\n        # QoS profile\n        qos_profile = QoSProfile(\n            reliability=ReliabilityPolicy.RELIABLE,\n            history=HistoryPolicy.KEEP_LAST,\n            depth=10\n        )\n\n        # Subscribers\n        self.cmd_subscriber = self.create_subscription(\n            Float64MultiArray,\n            \'/joint_commands\',\n            self.cmd_callback,\n            qos_profile\n        )\n\n        self.state_subscriber = self.create_subscription(\n            Float64MultiArray,\n            \'/joint_states\',\n            self.state_callback,\n            qos_profile\n        )\n\n        # State storage\n        self.current_command = None\n        self.current_state = None\n\n        # Error tracking\n        self.error_history = []\n        self.max_history = 1000\n\n        self.get_logger().info(\'Joint state subscriber initialized\')\n\n    def cmd_callback(self, msg):\n        """Store latest command."""\n        self.current_command = np.array(msg.data)\n\n    def state_callback(self, msg):\n        """Process joint state, compute error."""\n        self.current_state = np.array(msg.data)\n\n        if self.current_command is not None:\n            error = self.current_command - self.current_state\n            self.error_history.append(error.copy())\n\n            # Trim history\n```python\n```python\n            if len(self.error_history) > self.max_history:\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'                self.error_history.pop(0)\n\n            # Log RMS error\n            rms_error = np.sqrt(np.mean(error**2))\n            self.get_logger().info(f\'RMS tracking error: {rms_error:.4f} rad\')\n\n    def get_statistics(self):\n        """Compute error statistics."""\n```python\n```python\n        if len(self.error_history) < 10:\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"            return None\n\n        errors = np.array(self.error_history)\n        return {\n            'mean_error': np.mean(np.abs(errors), axis=0),\n            'max_error': np.max(np.abs(errors), axis=0),\n            'rms_error': np.sqrt(np.mean(errors**2, axis=0))\n        }\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = JointStateSubscriber()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        stats = node.get_statistics()\n        if stats:\n            print(\"\\nError Statistics:\")\n            print(f\"Mean: {stats['mean_error']}\")\n            print(f\"Max:  {stats['max_error']}\")\n            print(f\"RMS:  {stats['rms_error']}\")\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\n```python\n```python\nif __name__ == '__main__':\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"    main()\n"})}),"\n",(0,i.jsx)("checkpoint",{children:(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Expected"}),": Subscriber receives commands and (simulated) states, computes tracking errors."]})}),"\n",(0,i.jsx)(n.h3,{id:"step-4-implement-a-ros2-service",children:"Step 4: Implement a ROS2 Service"}),"\n",(0,i.jsx)(n.p,{children:"Create a service for robot mode switching:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\"\"\"\nrobot_service.py\nProvides a service for robot mode switching.\n\"\"\"\n\nimport rclpy\nfrom rclpy.node import Node\nfrom std_srvs.srv import SetBool\nfrom rcl_interfaces.msg import SetParametersResult\n\nclass RobotModeService(Node):\n    \"\"\"Service node for robot mode control.\"\"\"\n\n    def __init__(self):\n        super().__init__('robot_mode_service')\n\n        # Service\n        self.srv = self.create_service(\n            SetBool,\n            '/robot/enable',\n            self.enable_callback\n        )\n\n        # State\n        self.enabled = False\n\n        # Parameters\n        self.declare_parameter('max_velocity', 1.0)\n        self.declare_parameter('safety_enabled', True)\n\n        self.get_logger().info('Robot mode service ready')\n\n    def enable_callback(self, request, response):\n        \"\"\"Handle enable/disable requests.\"\"\"\n        if request.data:\n            # Enable robot\n            safety_ok = self.get_parameter('safety_enabled').value\n            if safety_ok:\n                self.enabled = True\n                response.success = True\n                response.message = 'Robot enabled'\n                self.get_logger().info('Robot ENABLED')\n            else:\n                response.success = False\n                response.message = 'Cannot enable: safety checks failed'\n                self.get_logger().warn('Enable request rejected: safety')\n        else:\n            # Disable robot\n            self.enabled = False\n            response.success = True\n            response.message = 'Robot disabled'\n            self.get_logger().info('Robot DISABLED')\n\n        return response\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = RobotModeService()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\n```python\n```python\nif __name__ == '__main__':\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"    main()\n"})}),"\n",(0,i.jsx)(n.p,{children:"Test the service:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# In one terminal\npython3 robot_service.py\n\n# In another terminal\nros2 service list\nros2 service call /robot/enable std_srvs/srv/SetBool "{data: true}"\nros2 service call /robot/enable std_srvs/srv/SetBool "{data: false}"\n'})}),"\n",(0,i.jsx)("checkpoint",{children:(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Expected"}),": Service responds to enable/disable requests with success/failure."]})}),"\n",(0,i.jsx)(n.h3,{id:"step-5-create-launch-file",children:"Step 5: Create Launch File"}),"\n",(0,i.jsx)(n.p,{children:"Create a launch file to start all nodes:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\"\"\"\nrobot_launch.py\nLaunch file for robot control system.\n\"\"\"\n\nfrom launch import LaunchDescription\nfrom launch_ros.actions import Node\nfrom launch.actions import DeclareLaunchArgument\nfrom launch.substitutions import LaunchConfiguration\n\ndef generate_launch_description():\n    \"\"\"Generate launch description.\"\"\"\n\n    # Declare arguments\n    sim_arg = DeclareLaunchArgument(\n        'use_sim',\n        default_value='true',\n        description='Use simulation time'\n    )\n\n    rate_arg = DeclareLaunchArgument(\n        'control_rate',\n        default_value='100.0',\n        description='Control loop rate in Hz'\n    )\n\n    # Nodes\n    command_publisher = Node(\n        package='physical_ai_textbook',\n        executable='joint_publisher',\n        name='joint_command_publisher',\n        parameters=[{\n            'use_sim_time': LaunchConfiguration('use_sim'),\n            'publish_rate': LaunchConfiguration('control_rate')\n        }],\n        output='screen'\n    )\n\n    state_subscriber = Node(\n        package='physical_ai_textbook',\n        executable='joint_subscriber',\n        name='joint_state_subscriber',\n        parameters=[{\n            'use_sim_time': LaunchConfiguration('use_sim')\n        }],\n        output='screen'\n    )\n\n    mode_service = Node(\n        package='physical_ai_textbook',\n        executable='robot_service',\n        name='robot_mode_service',\n        parameters=[{\n            'max_velocity': 1.5,\n            'safety_enabled': True\n        }],\n        output='screen'\n    )\n\n    return LaunchDescription([\n        sim_arg,\n        rate_arg,\n        command_publisher,\n        state_subscriber,\n        mode_service\n    ])\n"})}),"\n",(0,i.jsx)("checkpoint",{children:(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Expected"}),": Launch file syntax is valid, all nodes can be started together."]})}),"\n",(0,i.jsx)(n.h3,{id:"step-6-qos-configuration-for-real-time",children:"Step 6: QoS Configuration for Real-Time"}),"\n",(0,i.jsx)(n.p,{children:"Explore QoS settings impact:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\n"""\nqos_comparison.py\nCompare different QoS settings for robot communication.\n"""\n\nimport rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import Float64MultiArray\nfrom rclpy.qos import QoSProfile, QoSReliabilityPolicy, QoSHistoryPolicy, QoSDurabilityPolicy\nimport time\n\nclass QoSComparisonNode(Node):\n    """Test different QoS configurations."""\n\n    def __init__(self):\n        super().__init__(\'qos_comparison\')\n\n        # QoS profiles to test\n        self.qos_profiles = {\n            \'best_effort\': QoSProfile(\n                reliability=QoSReliabilityPolicy.BEST_EFFORT,\n                history=QoSHistoryPolicy.KEEP_LAST,\n                depth=1\n            ),\n            \'reliable\': QoSProfile(\n                reliability=QoSReliabilityPolicy.RELIABLE,\n                history=QoSHistoryPolicy.KEEP_LAST,\n                depth=10\n            ),\n            \'sensor_data\': QoSProfile(\n                reliability=QoSReliabilityPolicy.BEST_EFFORT,\n                history=QoSHistoryPolicy.KEEP_LAST,\n                depth=5,\n                durability=QoSDurabilityPolicy.VOLATILE\n            ),\n            \'control_command\': QoSProfile(\n                reliability=QoSReliabilityPolicy.RELIABLE,\n                history=QoSHistoryPolicy.KEEP_LAST,\n                depth=1,\n                durability=QoSDurabilityPolicy.TRANSIENT_LOCAL\n            )\n        }\n\n        # Statistics\n        self.message_counts = {name: 0 for name in self.qos_profiles}\n        self.latencies = {name: [] for name in self.qos_profiles}\n\n        # Create publishers for each profile\n        self.publishers = {}\n        self.subscribers = {}\n\n        for name, qos in self.qos_profiles.items():\n            topic = f\'/test_{name}\'\n            self.publishers[name] = self.create_publisher(\n                Float64MultiArray, topic, qos\n            )\n            self.subscribers[name] = self.create_subscription(\n                Float64MultiArray, topic,\n                lambda msg, n=name: self.callback(msg, n),\n                qos\n            )\n\n        # Timer for publishing\n        self.timer = self.create_timer(0.01, self.publish_all)  # 100 Hz\n        self.start_time = time.time()\n\n        self.get_logger().info(\'QoS comparison node started\')\n\n    def publish_all(self):\n        """Publish to all topics."""\n        msg = Float64MultiArray()\n        msg.data = [time.time()]  # Timestamp for latency measurement\n\n        for pub in self.publishers.values():\n            pub.publish(msg)\n\n    def callback(self, msg, profile_name):\n        """Handle received message."""\n        self.message_counts[profile_name] += 1\n\n        # Compute latency\n        send_time = msg.data[0]\n        recv_time = time.time()\n        latency = (recv_time - send_time) * 1000  # ms\n        self.latencies[profile_name].append(latency)\n\n    def report(self):\n        """Print statistics."""\n        duration = time.time() - self.start_time\n        print(f"\\nQoS Comparison Results ({duration:.1f}s):")\n        print("-" * 60)\n\n        for name in self.qos_profiles:\n            count = self.message_counts[name]\n            lats = self.latencies[name]\n\n            if lats:\n                avg_lat = sum(lats) / len(lats)\n                max_lat = max(lats)\n                print(f"{name:20s}: {count:5d} msgs, "\n                      f"avg latency: {avg_lat:.2f}ms, max: {max_lat:.2f}ms")\n            else:\n                print(f"{name:20s}: {count:5d} msgs, no latency data")\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = QoSComparisonNode()\n\n    try:\n        # Run for 10 seconds\n        timeout = 10.0\n        start = time.time()\n```python\n```python\n        while time.time() - start < timeout:\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"            rclpy.spin_once(node, timeout_sec=0.1)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.report()\n        node.destroy_node()\n        rclpy.shutdown()\n\n```python\n```python\nif __name__ == '__main__':\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"    main()\n"})}),"\n",(0,i.jsx)("checkpoint",{children:(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Expected"}),": Different QoS profiles show different message delivery characteristics."]})}),"\n",(0,i.jsx)(n.h2,{id:"expected-outcomes",children:"Expected Outcomes"}),"\n",(0,i.jsx)(n.p,{children:"After completing this lab, you should have:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Code artifacts"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"joint_publisher.py"}),": Joint command publisher"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"joint_subscriber.py"}),": Joint state subscriber"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"robot_service.py"}),": Robot mode service"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"robot_launch.py"}),": Launch file"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"qos_comparison.py"}),": QoS analysis tool"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Understanding"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"ROS2 node architecture"}),"\n",(0,i.jsx)(n.li,{children:"Topic-based communication for continuous data"}),"\n",(0,i.jsx)(n.li,{children:"Service-based communication for discrete operations"}),"\n",(0,i.jsx)(n.li,{children:"QoS profile selection for robotics applications"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Running system"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Multiple nodes communicating via topics and services"}),"\n",(0,i.jsx)(n.li,{children:"Understanding of message latency and reliability"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"rubric",children:"Rubric"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Criterion"}),(0,i.jsx)(n.th,{children:"Points"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Publisher Node"}),(0,i.jsx)(n.td,{children:"20"}),(0,i.jsx)(n.td,{children:"Correct topic publishing at specified rate"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Subscriber Node"}),(0,i.jsx)(n.td,{children:"20"}),(0,i.jsx)(n.td,{children:"Proper message handling and statistics"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Service Node"}),(0,i.jsx)(n.td,{children:"20"}),(0,i.jsx)(n.td,{children:"Working request/response handling"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Launch File"}),(0,i.jsx)(n.td,{children:"15"}),(0,i.jsx)(n.td,{children:"Valid launch configuration"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"QoS Analysis"}),(0,i.jsx)(n.td,{children:"15"}),(0,i.jsx)(n.td,{children:"Understanding of QoS tradeoffs"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Documentation"}),(0,i.jsx)(n.td,{children:"10"}),(0,i.jsx)(n.td,{children:"Clear code comments and README"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Total"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"100"})}),(0,i.jsx)(n.td,{})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"common-errors",children:"Common Errors"}),"\n",(0,i.jsxs)("troubleshooting",{children:[(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Error"}),': "No module named rclpy"\n',(0,i.jsx)(n.strong,{children:"Solution"}),": Ensure ROS2 is sourced: ",(0,i.jsx)(n.code,{children:"source /opt/ros/humble/setup.bash"})]}),(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Error"}),": Topic not found by subscriber\n",(0,i.jsx)(n.strong,{children:"Solution"}),": Check topic names match, verify QoS compatibility."]}),(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Error"}),": Service timeout\n",(0,i.jsx)(n.strong,{children:"Solution"}),": Ensure service node is running, check network configuration."]})]}),"\n",(0,i.jsx)(n.h2,{id:"extensions",children:"Extensions"}),"\n",(0,i.jsx)(n.p,{children:"For advanced students:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Actions"}),": Implement action server for trajectory execution"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Parameter Server"}),": Dynamic reconfiguration of controller gains"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Lifecycle Nodes"}),": Proper startup/shutdown management"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Component Nodes"}),": Efficient single-process multi-node setup"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"related-content",children:"Related Content"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Theory"}),": Module 09 theory.md, Section 9.1 (ROS2 Architecture)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Next Lab"}),": Lab 09-02 (tf2 and Coordinate Frames)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Application"}),": Real robot integration, multi-robot systems"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>o,x:()=>l});var r=s(6540);const i={},t=r.createContext(i);function o(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);